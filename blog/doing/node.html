<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js+Express+MongoDB | Chloe's Blog</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.3.4">
    <link rel="preload stylesheet" href="/assets/style.DCHhSuQr.css" as="style">
    
    <script type="module" src="/assets/app.CXUg0SzC.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.BTE0HxQO.js">
    <link rel="modulepreload" href="/assets/chunks/framework.D6PIRKQ_.js">
    <link rel="modulepreload" href="/assets/blog_doing_node.md.D2P-IzBa.lean.js">
    <link rel="icon" href="/icon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-99b11b48><!--[--><!--]--><!--[--><span tabindex="-1" data-v-78a082bc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-78a082bc> Skip to content </a><!--]--><!----><header class="VPNav" data-v-99b11b48 data-v-890dbb59><div class="VPNavBar" data-v-890dbb59 data-v-568d6690><div class="wrapper" data-v-568d6690><div class="container" data-v-568d6690><div class="title" data-v-568d6690><div class="VPNavBarTitle" data-v-568d6690 data-v-e7f4b601><a class="title" href="/" data-v-e7f4b601><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-c6ea86e6><!--]--><span data-v-e7f4b601>Hi! It&#39;s me!Chloe here~</span><!--[--><!--]--></a></div></div><div class="content" data-v-568d6690><div class="content-body" data-v-568d6690><!--[--><!--]--><div class="VPNavBarSearch search" data-v-568d6690><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-568d6690 data-v-433fafd4><span id="main-nav-aria-label" class="visually-hidden" data-v-433fafd4> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-433fafd4 data-v-1508bec4><!--[--><span data-v-1508bec4>ğŸ Home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-433fafd4 data-v-4cd1ae5f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cd1ae5f><span class="text" data-v-4cd1ae5f><!----><span data-v-4cd1ae5f>ğŸŒ³Blog</span><span class="vpi-chevron-down text-icon" data-v-4cd1ae5f></span></span></button><div class="menu" data-v-4cd1ae5f><div class="VPMenu" data-v-4cd1ae5f data-v-2ea227a3><div class="items" data-v-2ea227a3><!--[--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link active" href="/blog/doing/node.html" data-v-d31e68e1><!--[-->What I Am Doing<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-433fafd4 data-v-4cd1ae5f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cd1ae5f><span class="text" data-v-4cd1ae5f><!----><span data-v-4cd1ae5f>ğŸŒ±Life Insights</span><span class="vpi-chevron-down text-icon" data-v-4cd1ae5f></span></span></button><div class="menu" data-v-4cd1ae5f><div class="VPMenu" data-v-4cd1ae5f data-v-2ea227a3><div class="items" data-v-2ea227a3><!--[--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/life/2022/summary.html" data-v-d31e68e1><!--[-->2022<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/life/2023/June.html" data-v-d31e68e1><!--[-->2023<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/life/2024/" data-v-d31e68e1><!--[-->2024<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-433fafd4 data-v-4cd1ae5f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cd1ae5f><span class="text" data-v-4cd1ae5f><!----><span data-v-4cd1ae5f>ğŸŒµEnglish Corner</span><span class="vpi-chevron-down text-icon" data-v-4cd1ae5f></span></span></button><div class="menu" data-v-4cd1ae5f><div class="VPMenu" data-v-4cd1ae5f data-v-2ea227a3><div class="items" data-v-2ea227a3><!--[--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/english/youtube/Tiffani.html" data-v-d31e68e1><!--[-->Learning in YouTube<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/english/cambly/cambly.html" data-v-d31e68e1><!--[-->Cambly<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/english/article/may.html" data-v-d31e68e1><!--[-->Record<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-433fafd4 data-v-4cd1ae5f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-4cd1ae5f><span class="text" data-v-4cd1ae5f><!----><span data-v-4cd1ae5f>ğŸŒ²Movies and Books</span><span class="vpi-chevron-down text-icon" data-v-4cd1ae5f></span></span></button><div class="menu" data-v-4cd1ae5f><div class="VPMenu" data-v-4cd1ae5f data-v-2ea227a3><div class="items" data-v-2ea227a3><!--[--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/list/movie/" data-v-d31e68e1><!--[-->Movie and TV show list<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-2ea227a3 data-v-d31e68e1><a class="VPLink link" href="/list/book/" data-v-d31e68e1><!--[-->Book List<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-433fafd4 data-v-1508bec4><!--[--><span data-v-1508bec4>ğŸŒ·About Me</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-568d6690 data-v-00a7e316><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-00a7e316 data-v-0c8d7b6e data-v-0f86f76e><span class="check" data-v-0f86f76e><span class="icon" data-v-0f86f76e><!--[--><span class="vpi-sun sun" data-v-0c8d7b6e></span><span class="vpi-moon moon" data-v-0c8d7b6e></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-568d6690 data-v-a4b8fe0c data-v-111f9698><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Chloe2099" aria-label="github" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://instagram.com/chloe20990109/" aria-label="instagram" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-instagram" /></a><a class="VPSocialLink no-icon" href="..." aria-label="youtube" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-youtube" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-568d6690 data-v-09bf06d1 data-v-4cd1ae5f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4cd1ae5f><span class="vpi-more-horizontal icon" data-v-4cd1ae5f></span></button><div class="menu" data-v-4cd1ae5f><div class="VPMenu" data-v-4cd1ae5f data-v-2ea227a3><!----><!--[--><!--[--><!----><div class="group" data-v-09bf06d1><div class="item appearance" data-v-09bf06d1><p class="label" data-v-09bf06d1>Appearance</p><div class="appearance-action" data-v-09bf06d1><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-09bf06d1 data-v-0c8d7b6e data-v-0f86f76e><span class="check" data-v-0f86f76e><span class="icon" data-v-0f86f76e><!--[--><span class="vpi-sun sun" data-v-0c8d7b6e></span><span class="vpi-moon moon" data-v-0c8d7b6e></span><!--]--></span></span></button></div></div></div><div class="group" data-v-09bf06d1><div class="item social-links" data-v-09bf06d1><div class="VPSocialLinks social-links-list" data-v-09bf06d1 data-v-111f9698><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Chloe2099" aria-label="github" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://instagram.com/chloe20990109/" aria-label="instagram" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-instagram" /></a><a class="VPSocialLink no-icon" href="..." aria-label="youtube" target="_blank" rel="noopener" data-v-111f9698 data-v-310598df><span class="vpi-social-youtube" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-568d6690 data-v-299f6c15><span class="container" data-v-299f6c15><span class="top" data-v-299f6c15></span><span class="middle" data-v-299f6c15></span><span class="bottom" data-v-299f6c15></span></span></button></div></div></div></div><div class="divider" data-v-568d6690><div class="divider-line" data-v-568d6690></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-99b11b48 data-v-42bc5d56><div class="container" data-v-42bc5d56><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-42bc5d56 data-v-7b96e0b5><button data-v-7b96e0b5>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-99b11b48 data-v-fd62db96><div class="VPDoc has-aside" data-v-fd62db96 data-v-b0fc1131><!--[--><!--]--><div class="container" data-v-b0fc1131><div class="aside" data-v-b0fc1131><div class="aside-curtain" data-v-b0fc1131></div><div class="aside-container" data-v-b0fc1131><div class="aside-content" data-v-b0fc1131><div class="VPDocAside" data-v-b0fc1131 data-v-af9f6ade><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-af9f6ade data-v-d9e0cb53><div class="content" data-v-d9e0cb53><div class="outline-marker" data-v-d9e0cb53></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-d9e0cb53>outline</div><ul class="VPDocOutlineItem root" data-v-d9e0cb53 data-v-bef101e6><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-af9f6ade></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-b0fc1131><div class="content-container" data-v-b0fc1131><!--[--><!--]--><main class="main" data-v-b0fc1131><div style="position:relative;" class="vp-doc _blog_doing_node" data-v-b0fc1131><div><h1 id="node-js-express-mongodb" tabindex="-1">Node.js+Express+MongoDB <a class="header-anchor" href="#node-js-express-mongodb" aria-label="Permalink to &quot;Node.js+Express+MongoDB&quot;">â€‹</a></h1><h2 id="node-js" tabindex="-1">Node.js <a class="header-anchor" href="#node-js" aria-label="Permalink to &quot;Node.js&quot;">â€‹</a></h2><h3 id="node-farm" tabindex="-1">node-farm <a class="header-anchor" href="#node-farm" aria-label="Permalink to &quot;node-farm&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>milliseconds [ËˆmiliËŒsekÉ™ndz]<br>n. æ¯«ç§’( millisecondçš„å¤æ•°å½¢å¼ )</th><th></th></tr></thead><tbody><tr><td>paradigm [&#39;pÃ¦rÓ™daim]<br>n. èŒƒä¾‹, å¼æ ·, è¯å½¢å˜åŒ–è¡¨, çºµèšåˆå…³ç³»è¯­è¨€é¡¹</td><td></td></tr><tr><td>syntax [&#39;sintÃ¦ks]<br>n. å¥æ³•, è¯­æ³•, å¥å­æ„é€ <br>[è®¡] å¥æ³•, è¯­æ³•</td><td></td></tr><tr><td></td><td></td></tr></tbody></table><p>i am using Node.js v18.16.0</p><p>FS.module</p><p><a href="https://nodejs.org/dist/latest-v18.x/docs/api/fs.html#file-system" target="_blank" rel="noreferrer">File system</a></p><p><strong>index.js</strong></p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> textIn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./starter/txt/input.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(textIn);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> textOut</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `This is what we know about the avocado: ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">textIn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Created on ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./starter/txt/output.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, textOut)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;File written!!!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p><strong>synchronous</strong> is basically processed on after another,line by line.(<strong>blocking</strong>)</p><p><strong>asynchronous (non-blocking)</strong></p><p>callback hell</p><p>SOLUTION: Using Promises or Async/Await [Optional Section]</p><p>file</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file system</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// blocking, synchronous way</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const textIn = fs.readFileSync(&#39;./starter/txt/input.txt&#39;,&#39;utf-8&#39;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// console.log(textIn);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const textOut = `This is what we know about the avocado: ${textIn}.\nCreated on ${Date.now()}`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fs.writeFileSync(&#39;./starter/txt/output.txt&#39;, textOut)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// console.log(&#39;File written!!!&#39;);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Non-blocking, asynchronous way</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1.start.txtçš„æ–‡ä»¶å†…å®¹æ˜¯read-thisï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2.è¯»å–åˆ°å†…å®¹ä¹‹åå†å»è¯»åä¸ºread-this.txtçš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3.æŠŠå†…å®¹å†™è¿›final.txt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./starter/txt/start.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`./starter/txt/${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.txt`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data2); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// next</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./starter/txt/append.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data3);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./starter/txt/final.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;your file has been written ğŸ¤ª&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;will read file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// first</span></span></code></pre></div><p>server</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ---------------------------------------------------server--------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello from the serverğŸ’&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;listening to request port 8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>url</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;http&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;url&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ---------------------------------------------------server--------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  pathName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> req.url</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pathName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  pathName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/overview&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;This is the OVERVIEW&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pathName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/product&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;This is the PRODUCT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;Content-type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text/html&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &#39;my-own-header&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello-world&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;h1&gt;Page not found!!&lt;/h1&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;listening to request port 8000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>è¯·æ±‚jsonæ•°æ®</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;)  // file system</span></span>
<span class="line"><span>const http = require(&#39;http&#39;)</span></span>
<span class="line"><span>const url = require(&#39;url&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ---------------------------------------------------server--------------------------------------------------------------</span></span>
<span class="line"><span>const server = http.createServer((req,res) =&gt; {</span></span>
<span class="line"><span>    const  pathName = req.url</span></span>
<span class="line"><span>    if(pathName === &#39;/&#39; ||  pathName === &#39;/overview&#39;) {</span></span>
<span class="line"><span>        res.end(&#39;This is the OVERVIEW&#39;)</span></span>
<span class="line"><span>    } else if (pathName === &#39;/product&#39;) {</span></span>
<span class="line"><span>        res.end(&#39;This is the PRODUCT&#39;)</span></span>
<span class="line"><span>    } else if(pathName === &#39;/api&#39;) {</span></span>
<span class="line"><span>        fs.readFile(`${__dirname}/final/dev-data/data.json`,&#39;utf-8&#39;, (err,data) =&gt; {</span></span>
<span class="line"><span>           const productData = JSON.parse(data)</span></span>
<span class="line"><span>           res.writeHead(200,{</span></span>
<span class="line"><span>            &#39;Content-type&#39; : &#39;application/json&#39;</span></span>
<span class="line"><span>           })</span></span>
<span class="line"><span>           res.end(data)</span></span>
<span class="line"><span>        })</span></span>
<span class="line"><span>    } else {</span></span>
<span class="line"><span>        res.writeHead(404, {</span></span>
<span class="line"><span>            &#39;Content-type&#39; : &#39;text/html&#39;,</span></span>
<span class="line"><span>            &#39;my-own-header&#39; : &#39;hello-world&#39;</span></span>
<span class="line"><span>        })</span></span>
<span class="line"><span>        res.end(&#39;&lt;h1&gt;Page not found!!&lt;/h1&gt;&#39;)</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span>server.listen(8000, &#39;127.0.0.1&#39;, () =&gt; {</span></span>
<span class="line"><span>    console.log(&#39;listening to request port 8000&#39;);</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// -----------------------------------------------------------------------------------------------------------------</span></span></code></pre></div><p>åªè¯»å–ä¸€æ¬¡jsonæ–‡ä»¶ <strong>fs.readFileSync</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&quot;fs&quot;); // file system</span></span>
<span class="line"><span>const http = require(&quot;http&quot;);</span></span>
<span class="line"><span>const url = require(&quot;url&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ---------------------------------------------------server--------------------------------------------------------------</span></span>
<span class="line"><span>const data = fs.readFileSync(`${__dirname}/final/dev-data/data.json`, &quot;utf-8&quot;);</span></span>
<span class="line"><span>const dataObj = JSON.parse(data);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const server = http.createServer((req, res) =&gt; {</span></span>
<span class="line"><span>  const pathName = req.url;</span></span>
<span class="line"><span>  if (pathName === &quot;/&quot; || pathName === &quot;/overview&quot;) {</span></span>
<span class="line"><span>    res.end(&quot;This is the OVERVIEW&quot;);</span></span>
<span class="line"><span>  } else if (pathName === &quot;/product&quot;) {</span></span>
<span class="line"><span>    res.end(&quot;This is the PRODUCT&quot;);</span></span>
<span class="line"><span>  } else if (pathName === &quot;/api&quot;) {</span></span>
<span class="line"><span>    res.writeHead(200, {</span></span>
<span class="line"><span>        &quot;Content-type&quot;: &quot;application/json&quot;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>      res.end(data);</span></span>
<span class="line"><span>  } else {</span></span>
<span class="line"><span>    res.writeHead(404, {</span></span>
<span class="line"><span>      &quot;Content-type&quot;: &quot;text/html&quot;,</span></span>
<span class="line"><span>      &quot;my-own-header&quot;: &quot;hello-world&quot;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>    res.end(&quot;&lt;h1&gt;Page not found!!&lt;/h1&gt;&quot;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span>server.listen(8000, &quot;127.0.0.1&quot;, () =&gt; {</span></span>
<span class="line"><span>  console.log(&quot;listening to request port 8000&quot;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>node-farm</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ---------------------------------------------------server--------------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// We just only executed once,right at the beginning</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> replaceTemplate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">temp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">product</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%PRODUCTNAME%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.productName); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// gå…¨å±€æ›¿æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%IMAGE%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.image);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%FROM%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.from);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%NUTRIENTS%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.nutrients);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%QUANTITY%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.quantity);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%PRICE%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.price);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%DESCRIPTION%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.description);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%ID%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">product.organic)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%NOT_ORGANIC%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;not-organic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempOverview</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/final/templates/template-overview.html`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;utf-8&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempCard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/final/templates/template-card.html`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;utf-8&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempProduct</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/final/templates/template-product.html`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;utf-8&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/final/dev-data/data.json`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> dataObj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pathname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> url.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.url, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //   overview page</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/overview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;Content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> cardHtml</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dataObj</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">el</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> replaceTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tempCard, el))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> output</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tempOverview.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{%PRODUCT_CARDS%}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cardHtml);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(output);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // product page</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/product&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> product</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dataObj[query.id]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> output</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> replaceTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tempProduct, product)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(output);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // api page</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pathname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;Content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //   404 page</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;Content-type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text/html&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;my-own-header&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello-world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;h1&gt;Page not found!!&lt;/h1&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;127.0.0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;listening to request port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>æŠŠæ¨¡å—æŠ½ç¦»å‡ºæ¥æ”¾åœ¨modules/.replaceTemplate.js</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">temp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">product</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%PRODUCTNAME%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.productName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%IMAGE%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.image);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%PRICE%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.price);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%FROM%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.from);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%NUTRIENTS%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.nutrients);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%QUANTITY%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.quantity);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%DESCRIPTION%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.description);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%ID%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, product.id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">product.organic) output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">{%NOT_ORGANIC%}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">g</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;not-organic&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> output;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>åœ¨index.jså¼•ç”¨</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> replaceTemplate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;../1-node-farm/final/modules/replaceTemplate&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><p>npm init</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>See `npm help init` for definitive documentation on these fields</span></span>
<span class="line"><span>and exactly what they do.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Use `npm install &lt;pkg&gt;` afterwards to install a package and</span></span>
<span class="line"><span>save it as a dependency in the package.json file.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Press ^C at any time to quit.</span></span>
<span class="line"><span>package name: (1-node-farm) node-farm</span></span>
<span class="line"><span>version: (1.0.0)</span></span>
<span class="line"><span>description: Learning node.js</span></span>
<span class="line"><span>entry point: (index.js)</span></span>
<span class="line"><span>test command:</span></span>
<span class="line"><span>git repository:</span></span>
<span class="line"><span>keywords:</span></span>
<span class="line"><span>author: Chloe</span></span>
<span class="line"><span>license: (ISC)</span></span>
<span class="line"><span>About to write to D:\learn-node\learn-node\project\1-node-farm\package.json:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;name&quot;: &quot;node-farm&quot;,</span></span>
<span class="line"><span>  &quot;version&quot;: &quot;1.0.0&quot;,</span></span>
<span class="line"><span>  &quot;description&quot;: &quot;Learning node.js&quot;,</span></span>
<span class="line"><span>  &quot;main&quot;: &quot;index.js&quot;,</span></span>
<span class="line"><span>  &quot;scripts&quot;: {</span></span>
<span class="line"><span>    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  &quot;author&quot;: &quot;Chloe&quot;,</span></span>
<span class="line"><span>  &quot;license&quot;: &quot;ISC&quot;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Is this OK? (yes)</span></span></code></pre></div><p>â€‹</p><p>npm install nodemon --save-dev</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node-farm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Learning node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;echo </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Error: no test specified</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &amp;&amp; exit 1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;author&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Chloe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;license&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ISC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;devDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;nodemon&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;^2.0.22&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>nodemon index.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[nodemon] 2.0.22</span></span>
<span class="line"><span>[nodemon] to restart at any time, enter `rs`</span></span>
<span class="line"><span>[nodemon] watching path(s): *.*</span></span>
<span class="line"><span>[nodemon] watching extensions: js,mjs,json</span></span>
<span class="line"><span>[nodemon] starting `node index.js`</span></span>
<span class="line"><span>listening to request port 8000</span></span></code></pre></div><p>npm run start / npm start</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;name&quot;: &quot;node-farm&quot;,</span></span>
<span class="line"><span>  &quot;version&quot;: &quot;1.0.0&quot;,</span></span>
<span class="line"><span>  &quot;description&quot;: &quot;Learning node.js&quot;,</span></span>
<span class="line"><span>  &quot;main&quot;: &quot;index.js&quot;,</span></span>
<span class="line"><span>  &quot;scripts&quot;: {</span></span>
<span class="line"><span>    &quot;start&quot;: &quot;nodemon index.js&quot;</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  &quot;author&quot;: &quot;Chloe&quot;,</span></span>
<span class="line"><span>  &quot;license&quot;: &quot;ISC&quot;,</span></span>
<span class="line"><span>  &quot;devDependencies&quot;: {</span></span>
<span class="line"><span>    &quot;nodemon&quot;: &quot;^2.0.22&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>&quot;nodemon&quot;: &quot;^2.0.22&quot;</p><p>^ means that we accept patch and minor releases.</p><p>2 major version --- afect the code /big change</p><p>0 minor version</p><p>22patch version</p><p>&quot;nodemon&quot;: &quot;~2.0.22&quot;</p><p>~ means only accept patch releases.This one is a bit safer.</p><p>&quot;nodemon&quot;: &quot;*2.0.22&quot;</p><p>*This one includes all the versions,</p><p><strong>25é›†http</strong></p><p><strong>30é›† threads and a thread pool.</strong></p><p>Event loop does orchestration äº‹ä»¶å¾ªç¯è¿›è¡Œç¼–æ’</p><p>START â†“ Expired timer callbacks è¿‡æœŸçš„è®¡æ—¶å™¨å›è°ƒ â†“ I/O polling and callbacks I/Oè½®è¯¢å’Œå›è°ƒ â†“ setlmmediate callbacks å³æ—¶å›è°ƒ â†“ Close callbacks å…³é—­å›è°ƒ</p><p>Don&#39;t use sync versions of functions in fs,crypto and zlib modules in your callback functions Don&#39;t perform complex calculations (e.g.loops inside loops) Be careful with JSON in large objects Don&#39;t use too complex regular expressions (e.g.nested quantifiers)</p><p>what is streams?</p><p>Used to process(read and write)data piece by piece(chunks). without completing the whole read or write operation,and therefore without keeping all the data in memory. such as NETFLIX and You Tube Perfect for handling large volumes of data,for example videos; More efficient data processing in terms of memory (no need to keep all data in memory)and time(we don&#39;t have to wait until all the data is available).</p><p>stream.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&quot;fs&quot;);</span></span>
<span class="line"><span>const server = require(&quot;http&quot;).createServer();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server.on(&quot;request&quot;, (req, res) =&gt; {</span></span>
<span class="line"><span>  // solution 1 ç›´æ¥è¯»å–å¤§æ–‡ä»¶ä¼šå´©æ‰</span></span>
<span class="line"><span>  // fs.readFile(&#39;./test-file.txt&#39;,(err,data) =&gt; {</span></span>
<span class="line"><span>  //     if(err) console.log(err);</span></span>
<span class="line"><span>  //     res.end(data)</span></span>
<span class="line"><span>  // })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // solution 2 consume piece by piece.So chunk by chunk.</span></span>
<span class="line"><span>  //   So in this case,backpressure happens when the response</span></span>
<span class="line"><span>  //   const readable = fs.createReadStream(&quot;test-file.txt&quot;);</span></span>
<span class="line"><span>  //   readable.on(&quot;data&quot;, (chunk) =&gt; {</span></span>
<span class="line"><span>  //     res.write(chunk);</span></span>
<span class="line"><span>  //   });</span></span>
<span class="line"><span>  //   readable.on(&quot;end&quot;, () =&gt; {</span></span>
<span class="line"><span>  //     res.end();</span></span>
<span class="line"><span>  //   });</span></span>
<span class="line"><span>  //   readable.on(&quot;error&quot;, (err) =&gt; {</span></span>
<span class="line"><span>  //     console.log(err);</span></span>
<span class="line"><span>  //     res.statusCode = 500;</span></span>
<span class="line"><span>  //     res.end(&quot;file not found&quot;);</span></span>
<span class="line"><span>  //   });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // solution 3</span></span>
<span class="line"><span>    const readable = fs.createReadStream(&quot;test-file.txt&quot;);</span></span>
<span class="line"><span>    readable.pipe(res)</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server.listen(8000, &quot;127.0.0.1&quot;, () =&gt; {</span></span>
<span class="line"><span>  console.log(&quot;listening....&quot;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>modules.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>console.log(arguments);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>node modules.js</span></span>
<span class="line"><span>// output</span></span>
<span class="line"><span>[Arguments] {</span></span>
<span class="line"><span>  &#39;0&#39;: {},</span></span>
<span class="line"><span>  &#39;1&#39;: [Function: require] {</span></span>
<span class="line"><span>    resolve: [Function: resolve] { paths: [Function: paths] },</span></span>
<span class="line"><span>    main: Module {</span></span>
<span class="line"><span>      id: &#39;.&#39;,</span></span>
<span class="line"><span>      path: &#39;D:\\learn-node\\learn-node\\project\\2-how-node-works&#39;,</span></span>
<span class="line"><span>      exports: {},</span></span>
<span class="line"><span>      filename: &#39;D:\\learn-node\\learn-node\\project\\2-how-node-works\\modules.js&#39;,</span></span>
<span class="line"><span>      loaded: false,</span></span>
<span class="line"><span>      children: [],</span></span>
<span class="line"><span>      paths: [Array]</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    extensions: [Object: null prototype] {</span></span>
<span class="line"><span>      &#39;.js&#39;: [Function (anonymous)],</span></span>
<span class="line"><span>      &#39;D:\\learn-node\\learn-node\\project\\2-how-node-works\\node_modules&#39;,</span></span>
<span class="line"><span>      &#39;D:\\learn-node\\learn-node\\project\\node_modules&#39;,</span></span>
<span class="line"><span>      &#39;D:\\learn-node\\learn-node\\node_modules&#39;,</span></span>
<span class="line"><span>      &#39;D:\\learn-node\\node_modules&#39;,</span></span>
<span class="line"><span>      &#39;D:\\node_modules&#39;</span></span>
<span class="line"><span>    ]</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  &#39;3&#39;: &#39;D:\\learn-node\\learn-node\\project\\2-how-node-works\\modules.js&#39;,</span></span>
<span class="line"><span>  &#39;4&#39;: &#39;D:\\learn-node\\learn-node\\project\\2-how-node-works&#39;</span></span>
<span class="line"><span>}</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>console.log(require(&#39;module&#39;).wrapper);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[</span></span>
<span class="line"><span>  &#39;(function (exports, require, module, __filename, __dirname) { &#39;,</span></span>
<span class="line"><span>  &#39;\n});&#39;</span></span>
<span class="line"><span>]</span></span></code></pre></div><p>test-module-1.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// class Calculator {</span></span>
<span class="line"><span>//     add(a,b) {</span></span>
<span class="line"><span>//         return a+b</span></span>
<span class="line"><span>//     }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//     multiply(a,b) {</span></span>
<span class="line"><span>//         return a*b</span></span>
<span class="line"><span>//     }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//     divide(a,b) {</span></span>
<span class="line"><span>//         return a / b</span></span>
<span class="line"><span>//     }</span></span>
<span class="line"><span>// }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = class {</span></span>
<span class="line"><span>    add(a,b) {</span></span>
<span class="line"><span>        return a+b</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    multiply(a,b) {</span></span>
<span class="line"><span>        return a*b</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    divide(a,b) {</span></span>
<span class="line"><span>        return a / b</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>test-module-2.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>exports.add = (a,b) =&gt; a+b</span></span>
<span class="line"><span>exports.multiply = (a,b) =&gt; a*b</span></span>
<span class="line"><span>exports.divide = (a,b) =&gt; a/b</span></span></code></pre></div><p>test-module-3.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>console.log(&#39;hello from the module&#39;); // the code inside of it was also executed once only.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = () =&gt; console.log(&#39;log this beautiful textğŸ˜ƒ&#39;);</span></span></code></pre></div><p>modules.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// console.log(arguments);</span></span>
<span class="line"><span>// console.log(require(&#39;module&#39;).wrapper);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// module.exports</span></span>
<span class="line"><span>const C = require(&#39;./test-module-1&#39;)</span></span>
<span class="line"><span>const calc1 = new C()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>console.log(calc1.add(2,5));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// exports</span></span>
<span class="line"><span>// const calc2 = require(&#39;./test-module-2&#39;)</span></span>
<span class="line"><span>// console.log(calc2.divide(10,5));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const { add, multiply, divide} = require(&#39;./test-module-2&#39;)</span></span>
<span class="line"><span>console.log(multiply(2,5));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//caching</span></span>
<span class="line"><span>require(&#39;./test-module-3&#39;)()</span></span>
<span class="line"><span>require(&#39;./test-module-3&#39;)()</span></span>
<span class="line"><span>require(&#39;./test-module-3&#39;)()</span></span></code></pre></div><p>call back hell</p><p>npm i superagent</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>fs.readFile(`${__dirname}/dog.txt`, (err, data) =&gt; {</span></span>
<span class="line"><span>  console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  superagent</span></span>
<span class="line"><span>    .get(`https://dog.ceo/api/breed/${data}/images/random`)</span></span>
<span class="line"><span>    .end((err, res) =&gt; {</span></span>
<span class="line"><span>        if (err) return console.log(err.message);</span></span>
<span class="line"><span>      console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      fs.writeFile(&#39;dog-img.txt&#39;,res.body.message,err =&gt; {</span></span>
<span class="line"><span>        console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>      })</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>use .then .catch</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>fs.readFile(`${__dirname}/dog.txt`, (err, data) =&gt; {</span></span>
<span class="line"><span>  console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  superagent</span></span>
<span class="line"><span>    .get(`https://dog.ceo/api/breed/${data}/images/random`)</span></span>
<span class="line"><span>    .then((res) =&gt; {</span></span>
<span class="line"><span>      if (err) return console.log(err.message);</span></span>
<span class="line"><span>      console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      fs.writeFile(&#39;dog-img.txt&#39;, res.body.message, (err) =&gt; {</span></span>
<span class="line"><span>        console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    })</span></span>
<span class="line"><span>    .catch((err) =&gt; {</span></span>
<span class="line"><span>      console.log(err.message);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>});</span></span></code></pre></div><ol><li><p>å¯¼å…¥äº†ä¸¤ä¸ªæ¨¡å—ï¼š<code>fs</code>å’Œ<code>superagent</code>ã€‚<code>fs</code>æ¨¡å—ç”¨äºæ–‡ä»¶è¯»å†™æ“ä½œï¼Œ<code>superagent</code>æ¨¡å—ç”¨äºå‘é€HTTPè¯·æ±‚ã€‚</p></li><li><p>å®šä¹‰äº†ä¸¤ä¸ªPromiseå‡½æ•°ï¼šreadFileProå’ŒwriteFileProï¼Œç”¨äºå°è£…fs.readFilefs.writeFileæ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¼‚æ­¥æ“ä½œä¸­ä½¿ç”¨ã€‚</p><ul><li><code>readFilePro</code>å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå®ƒä¼šè¯»å–æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶å†…å®¹ã€‚å¦‚æœè¯»å–æˆåŠŸï¼ŒPromiseå°†è¢«è§£æå¹¶ä¼ é€’æ–‡ä»¶å†…å®¹ï¼Œå¦åˆ™å°†è¢«æ‹’ç»å¹¶ä¼ é€’é”™è¯¯ä¿¡æ¯ã€‚</li><li><code>writeFilePro</code>å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å’Œæ•°æ®ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå®ƒä¼šå°†æŒ‡å®šæ•°æ®å†™å…¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚å¦‚æœå†™å…¥æˆåŠŸï¼ŒPromiseå°†è¢«è§£æå¹¶ä¼ é€’æˆåŠŸçš„æ¶ˆæ¯ï¼Œå¦åˆ™å°†è¢«æ‹’ç»å¹¶ä¼ é€’é”™è¯¯ä¿¡æ¯ã€‚</li></ul></li><li><p>è°ƒç”¨readFileProå‡½æ•°è¯»å–æ–‡ä»¶${__dirname}/dog.txt</p><p>ï¼Œå¹¶é€šè¿‡Promiseé“¾å¼è°ƒç”¨è¿›è¡Œåç»­æ“ä½œã€‚</p><ul><li>åœ¨ç¬¬ä¸€ä¸ª<code>then</code>å›è°ƒå‡½æ•°ä¸­ï¼Œè¾“å‡ºè¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä½¿ç”¨<code>superagent</code>å‘é€HTTP GETè¯·æ±‚ï¼Œè¯·æ±‚URLä¸º<code>https://dog.ceo/api/breed/${data}/images/random</code>ï¼Œå…¶ä¸­<code>${data}</code>æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–çš„å†…å®¹ã€‚è¿”å›çš„Promiseå°†åœ¨è¯·æ±‚æˆåŠŸåç»§ç»­é“¾å¼è°ƒç”¨ã€‚</li><li>åœ¨ç¬¬äºŒä¸ª<code>then</code>å›è°ƒå‡½æ•°ä¸­ï¼Œè¾“å‡ºå“åº”çš„ä¸»ä½“æ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨<code>writeFilePro</code>å‡½æ•°å°†æ¶ˆæ¯å†™å…¥æ–‡ä»¶<code>dog-img.txt</code>ã€‚è¿”å›çš„Promiseå°†åœ¨å†™å…¥æˆåŠŸåç»§ç»­é“¾å¼è°ƒç”¨ã€‚</li><li>åœ¨ç¬¬ä¸‰ä¸ª<code>then</code>å›è°ƒå‡½æ•°ä¸­ï¼Œè¾“å‡ºæˆåŠŸä¿å­˜æ–‡ä»¶çš„æ¶ˆæ¯ã€‚</li><li>åœ¨<code>catch</code>å›è°ƒå‡½æ•°ä¸­ï¼Œæ•è·ä»»ä½•Promiseé“¾ä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œå¹¶è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</li></ul></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const readFilePro = (file) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.readFile(file, (err, data) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;iI could not find the fileğŸ¤£&#39;);</span></span>
<span class="line"><span>      resolve(data);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const writeFilePro = (file, data) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.writeFile(file, data, (err) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;Could not write fileğŸ« &#39;);</span></span>
<span class="line"><span>      resolve(&#39;success&#39;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>readFilePro(`${__dirname}/dog.txt`)</span></span>
<span class="line"><span>  .then((data) =&gt; {</span></span>
<span class="line"><span>    console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return superagent.get(`https://dog.ceo/api/breed/${data}/images/random`);</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  .then((res) =&gt; {</span></span>
<span class="line"><span>    console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return writeFilePro(&#39;dog-img.txt&#39;, res.body.message);</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  .then(() =&gt; {</span></span>
<span class="line"><span>    console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  .catch((err) =&gt; {</span></span>
<span class="line"><span>    console.log(err.message);</span></span>
<span class="line"><span>  });</span></span></code></pre></div><p>async/await</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const readFilePro = (file) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.readFile(file, (err, data) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;I could not find the fileğŸ¤£&#39;);</span></span>
<span class="line"><span>      resolve(data);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const writeFilePro = (file, data) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.writeFile(file, data, (err) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;Could not write fileğŸ« &#39;);</span></span>
<span class="line"><span>      resolve(&#39;success&#39;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getDogPic = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const data = await readFilePro(`${__dirname}/dog.txt`);</span></span>
<span class="line"><span>    console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>    console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    await writeFilePro(&#39;dog-img.txt&#39;, res.body.message);</span></span>
<span class="line"><span>    console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>getDogPic();</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>console.log(&#39;1:Will get dog pics&#39;);</span></span>
<span class="line"><span>getDogPic();</span></span>
<span class="line"><span>console.log(&#39;2:Done getting dog pics&#39;);</span></span></code></pre></div><p>output</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1:Will get dog pics</span></span>
<span class="line"><span>2:Done getting dog pics</span></span>
<span class="line"><span>Breed:retriever</span></span>
<span class="line"><span>https://images.dog.ceo/breeds/retriever-curly/n02099429_2936.jpg</span></span>
<span class="line"><span>Rondom dog image saved to file~ğŸ˜</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const readFilePro = (file) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.readFile(file, (err, data) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;I could not find the fileğŸ¤£&#39;);</span></span>
<span class="line"><span>      resolve(data);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const writeFilePro = (file, data) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.writeFile(file, data, (err) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;Could not write fileğŸ« &#39;);</span></span>
<span class="line"><span>      resolve(&#39;success&#39;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getDogPic = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const data = await readFilePro(`${__dirname}/dog.txt`);</span></span>
<span class="line"><span>    console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>    console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    await writeFilePro(&#39;dog-img.txt&#39;, res.body.message);</span></span>
<span class="line"><span>    console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  return &#39;2:readyğŸ¥°&#39;;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span>console.log(&#39;1:Will get dog pics&#39;);</span></span>
<span class="line"><span>const x = getDogPic();</span></span>
<span class="line"><span>console.log(x);</span></span>
<span class="line"><span>console.log(&#39;3:Done getting dog pics&#39;);</span></span></code></pre></div><p>output</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1:Will get dog pics</span></span>
<span class="line"><span>Promise { &lt;pending&gt; }</span></span>
<span class="line"><span>3:Done getting dog pics</span></span>
<span class="line"><span>Breed:retriever</span></span>
<span class="line"><span>https://images.dog.ceo/breeds/retriever-flatcoated/n02099267_4359.jpg</span></span>
<span class="line"><span>Rondom dog image saved to file~ğŸ˜</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const getDogPic = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const data = await readFilePro(`${__dirname}/dog.txt`);</span></span>
<span class="line"><span>    console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>    console.log(res.body.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    await writeFilePro(&#39;dog-img.txt&#39;, res.body.message);</span></span>
<span class="line"><span>    console.log(&#39;Rondom dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  return &#39;2:readyğŸ¥°&#39;;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span>console.log(&#39;1:Will get dog pics&#39;);</span></span>
<span class="line"><span>getDogPic().then((x) =&gt; {</span></span>
<span class="line"><span>  console.log(x);</span></span>
<span class="line"><span>  console.log(&#39;3:Done getting dog pics&#39;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>output</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1:Will get dog pics</span></span>
<span class="line"><span>Breed:retriever</span></span>
<span class="line"><span>https://images.dog.ceo/breeds/retriever-golden/Z6A_4193-Edit-Edit_200806.jpg</span></span>
<span class="line"><span>Rondom dog image saved to file~ğŸ˜</span></span>
<span class="line"><span>2:readyğŸ¥°</span></span>
<span class="line"><span>3:Done getting dog pics</span></span></code></pre></div><p>ç«‹å³æ‰§è¡Œçš„åŒ¿åå¼‚æ­¥å‡½æ•°</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    console.log(&#39;1:Will get dog pics&#39;);</span></span>
<span class="line"><span>    const x = await getDogPic()</span></span>
<span class="line"><span>    console.log(x);</span></span>
<span class="line"><span>    console.log(&#39;3:Done getting dog pics&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(&#39;ERRORğŸ¤”&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>})()</span></span></code></pre></div><p>output</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1:Will get dog pics</span></span>
<span class="line"><span>Breed:retriever</span></span>
<span class="line"><span>https://images.dog.ceo/breeds/retriever-golden/n02099601_7916.jpg</span></span>
<span class="line"><span>Rondom dog image saved to file~ğŸ˜</span></span>
<span class="line"><span>2:readyğŸ¥°</span></span>
<span class="line"><span>3:Done getting dog pics</span></span></code></pre></div><p><code>Promise.all</code>çš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœä¼ å…¥çš„Promiseæ•°ç»„ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªå·²è§£æçš„Promiseï¼Œå…¶è§£æå€¼æ˜¯ä¸€ä¸ªç©ºæ•°ç»„<code>[]</code>ã€‚</li><li>å¦‚æœä¼ å…¥çš„Promiseæ•°ç»„ä¸­çš„æ‰€æœ‰Promiseéƒ½å·²è§£æï¼ˆresolveï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå…¶è§£æå€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ä¼ å…¥çš„Promiseå¯¹è±¡çš„è§£æå€¼ï¼Œä¸”é¡ºåºä¸ä¼ å…¥çš„Promiseå¯¹è±¡æ•°ç»„çš„é¡ºåºä¸€è‡´ã€‚</li><li>å¦‚æœä¼ å…¥çš„Promiseæ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªPromiseè¢«æ‹’ç»ï¼ˆrejectï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„Promiseï¼Œå…¶æ‹’ç»åŸå› æ˜¯ç¬¬ä¸€ä¸ªè¢«æ‹’ç»çš„Promiseçš„æ‹’ç»åŸå› ã€‚</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const superagent = require(&#39;superagent&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const readFilePro = (file) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.readFile(file, (err, data) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;I could not find the fileğŸ¤£&#39;);</span></span>
<span class="line"><span>      resolve(data);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const writeFilePro = (file, data) =&gt; {</span></span>
<span class="line"><span>  return new Promise((resolve, reject) =&gt; {</span></span>
<span class="line"><span>    fs.writeFile(file, data, (err) =&gt; {</span></span>
<span class="line"><span>      if (err) reject(&#39;Could not write fileğŸ« &#39;);</span></span>
<span class="line"><span>      resolve(&#39;success&#39;);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getDogPic = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const data = await readFilePro(`${__dirname}/dog.txt`);</span></span>
<span class="line"><span>    console.log(`Breed:${data}`);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res1Pro = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res2Pro = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const res3Pro = await superagent.get(</span></span>
<span class="line"><span>      `https://dog.ceo/api/breed/${data}/images/random`</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const all = await Promise.all([res1Pro,res2Pro,res3Pro])</span></span>
<span class="line"><span>    const imgs = all.map(el =&gt; el.body.message)</span></span>
<span class="line"><span>    console.log(imgs);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    await writeFilePro(&#39;dog-img.txt&#39;, imgs.join(&#39;\n&#39;));</span></span>
<span class="line"><span>    console.log(&#39;Random dog image saved to file~ğŸ˜&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>    throw err;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  return &#39;2:readyğŸ¥°&#39;;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span>(async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    console.log(&#39;1:Will get dog pics&#39;);</span></span>
<span class="line"><span>    const x = await getDogPic();</span></span>
<span class="line"><span>    console.log(x);</span></span>
<span class="line"><span>    console.log(&#39;3:Done getting dog pics&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(&#39;ERRORğŸ¤”&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>})();</span></span></code></pre></div><p>express</p><p>npm i express</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const app = express();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.get(&#39;/&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>  res</span></span>
<span class="line"><span>    .status(200)</span></span>
<span class="line"><span>    .json({ message: &#39;Hello from the server side!ğŸ¥°&#39;, app: &#39;Natours&#39; });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.post(&#39;/&#39;,(req,res) =&gt; {</span></span>
<span class="line"><span>    res.send(&#39;You can post to this endpointğŸ˜&#39;)</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const port = 3000;</span></span>
<span class="line"><span>app.listen(port, () =&gt; {</span></span>
<span class="line"><span>  console.log(&#39;App running on port ${port}...&#39;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>P50API</p><p>REST,which stands for Representational States Transfer,</p><p>1.Separate APl into logical resources 2Expose structured,resource-based URLs 3.Use HTTP methods (verbs) 3.Send data as JSON(usually) 4.Be stateless</p><p><code>app.use(express.json())</code> æ˜¯ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œç”¨äºå¤„ç†ä¼ å…¥çš„è¯·æ±‚ä¸­çš„ JSON æ•°æ®ã€‚</p><p>å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¸¦æœ‰ JSON æ•°æ®çš„è¯·æ±‚æ—¶ï¼Œä¾‹å¦‚é€šè¿‡ POST æˆ– PUT è¯·æ±‚å‘é€ JSON æ ¼å¼çš„æ•°æ®ï¼Œ<code>express.json()</code> ä¸­é—´ä»¶å‡½æ•°å°†è´Ÿè´£è§£æè¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º JavaScript å¯¹è±¡ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾åœ°è®¿é—®å’Œå¤„ç†è¿™äº›æ•°æ®ã€‚</p><p>ä½¿ç”¨ <code>app.use(express.json())</code> å¯ä»¥ç¡®ä¿ Express åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ­£ç¡®è§£æ JSON æ•°æ®ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™åç»­çš„è·¯ç”±å¤„ç†ç¨‹åºæˆ–ä¸­é—´ä»¶ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä½ çš„è·¯ç”±å¤„ç†ç¨‹åºä¸­ä½¿ç”¨ <code>req.body</code> å¯¹è±¡æ¥è®¿é—®å’Œæ“ä½œ JSON æ•°æ®ã€‚</p><p><strong>get</strong></p><p><strong>post</strong></p><p><strong>patch</strong></p><p><strong>delete</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const app = express();</span></span>
<span class="line"><span>app.use(express.json());</span></span>
<span class="line"><span>// app.get(&#39;/&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>//   res</span></span>
<span class="line"><span>//     .status(200)</span></span>
<span class="line"><span>//     .json({ message: &#39;Hello from the server side!ğŸ¥°&#39;, app: &#39;Natours&#39; });</span></span>
<span class="line"><span>// });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// app.post(&#39;/&#39;,(req,res) =&gt; {</span></span>
<span class="line"><span>//     res.send(&#39;You can post to this endpointğŸ˜&#39;)</span></span>
<span class="line"><span>// })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tours = JSON.parse(</span></span>
<span class="line"><span>  fs.readFileSync(`${__dirname}/dev-data/data/tours-simple.json`)</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.get(&#39;/api/v1/tours&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    result: tours.length,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tours,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.get(&#39;/api/v1/tours/:id&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>  console.log(req.params);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const id = req.params.id * 1; // it will then automatically convert that string to a number.</span></span>
<span class="line"><span>  if (id &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const tour = tours.find((el) =&gt; el.id === id);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  if (!tour) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    result: tours.length,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tour,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.post(&#39;/api/v1/tours&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>  const newId = tours[tours.length - 1].id + 1;</span></span>
<span class="line"><span>  const newTour = Object.assign({ id: newId }, req.body);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  tours.push(newTour);</span></span>
<span class="line"><span>  fs.writeFile(</span></span>
<span class="line"><span>    `${__dirname}/dev-data/data/tours-simple.json`,</span></span>
<span class="line"><span>    JSON.stringify(tours),</span></span>
<span class="line"><span>    (err) =&gt; {</span></span>
<span class="line"><span>      res.status(201).json({</span></span>
<span class="line"><span>        status: &#39;success&#39;,</span></span>
<span class="line"><span>        data: {</span></span>
<span class="line"><span>          tours: newTour,</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.patch(&#39;/api/v1/tours/:id&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>  if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tour: &#39;&lt;Updated tour here&gt;&#39;,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.delete(&#39;/api/v1/tours/:id&#39;, (req, res) =&gt; {</span></span>
<span class="line"><span>    if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>      return res.status(404).json({</span></span>
<span class="line"><span>        status: &#39;fail&#39;,</span></span>
<span class="line"><span>        message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // And 204 means no content.</span></span>
<span class="line"><span>    res.status(204).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      data: null</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>const port = 3000;</span></span>
<span class="line"><span>app.listen(port, () =&gt; {</span></span>
<span class="line"><span>  console.log(&#39;App running on port ${port}...&#39;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>å°è£…</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span>const app = express();</span></span>
<span class="line"><span>app.use(express.json());</span></span>
<span class="line"><span>const tours = JSON.parse(</span></span>
<span class="line"><span>  fs.readFileSync(`${__dirname}/dev-data/data/tours-simple.json`)</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getAllTours = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    result: tours.length,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tours,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getTour = (req, res) =&gt; {</span></span>
<span class="line"><span>  console.log(req.params);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const id = req.params.id * 1; // it will then automatically convert that string to a number.</span></span>
<span class="line"><span>  if (id &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const tour = tours.find((el) =&gt; el.id === id);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  if (!tour) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    result: tours.length,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tour,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const createTour = (req, res) =&gt; {</span></span>
<span class="line"><span>  const newId = tours[tours.length - 1].id + 1;</span></span>
<span class="line"><span>  const newTour = Object.assign({ id: newId }, req.body);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  tours.push(newTour);</span></span>
<span class="line"><span>  fs.writeFile(</span></span>
<span class="line"><span>    `${__dirname}/dev-data/data/tours-simple.json`,</span></span>
<span class="line"><span>    JSON.stringify(tours),</span></span>
<span class="line"><span>    (err) =&gt; {</span></span>
<span class="line"><span>      res.status(201).json({</span></span>
<span class="line"><span>        status: &#39;success&#39;,</span></span>
<span class="line"><span>        data: {</span></span>
<span class="line"><span>          tours: newTour,</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const updateTour = (req, res) =&gt; {</span></span>
<span class="line"><span>  if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tour: &#39;&lt;Updated tour here&gt;&#39;,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const deleteTour = (req, res) =&gt; {</span></span>
<span class="line"><span>  if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  // And 204 means no content.</span></span>
<span class="line"><span>  res.status(204).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    data: null,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span>// app.get(&#39;/api/v1/tours&#39;, getAllTours);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// app.get(&#39;/api/v1/tours/:id&#39;, getTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// app.post(&#39;/api/v1/tours&#39;, createTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// app.patch(&#39;/api/v1/tours/:id&#39;, updateTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// app.delete(&#39;/api/v1/tours/:id&#39;, deleteTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.route(&#39;/api/v1/tours&#39;).get(getAllTours).post(createTour);</span></span>
<span class="line"><span>app</span></span>
<span class="line"><span>  .route(&#39;/api/v1/tours/:id&#39;)</span></span>
<span class="line"><span>  .get(getTour)</span></span>
<span class="line"><span>  .patch(updateTour)</span></span>
<span class="line"><span>  .delete(deleteTour);</span></span>
<span class="line"><span>const port = 3000;</span></span>
<span class="line"><span>app.listen(port, () =&gt; {</span></span>
<span class="line"><span>  console.log(&#39;App running on port ${port}...&#39;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>use middleware</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>app.use(express.json());</span></span>
<span class="line"><span>app.use((req,res, next) =&gt; {</span></span>
<span class="line"><span>    console.log(&#39;Hello from the middleware~ğŸ’­&#39;);</span></span>
<span class="line"><span>    next()</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use((req,res,next) =&gt; {</span></span>
<span class="line"><span>    req.requestTime = new Date().toISOString()</span></span>
<span class="line"><span>    next()</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tours = JSON.parse(</span></span>
<span class="line"><span>  fs.readFileSync(`${__dirname}/dev-data/data/tours-simple.json`)</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const getAllTours = (req, res) =&gt; {</span></span>
<span class="line"><span>    console.log(req.requestTime);</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    result: tours.length,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tours,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>npm i morgan</p><p>Morgan æ˜¯ä¸€ä¸ªç”¨äº Node.js çš„æ—¥å¿—è®°å½•å™¨ï¼ˆloggerï¼‰åº“ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…è®°å½•å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¿¡æ¯ã€‚æ—¥å¿—è®°å½•æ˜¯è½¯ä»¶å¼€å‘ä¸­éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥ç”¨äºè°ƒè¯•ã€é”™è¯¯è¿½è¸ªã€æ€§èƒ½ç›‘æ§ä»¥åŠç”Ÿæˆè¿è¡ŒæŠ¥å‘Šç­‰æ–¹é¢ã€‚</p><p>Morgan æä¾›äº†ä¸€ä¸ªä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰å‡½æ•°ï¼Œå¯ä»¥è½»æ¾åœ°é›†æˆåˆ° Express.js æˆ–å…¶ä»– Node.js Web æ¡†æ¶ä¸­ã€‚å®ƒå¯ä»¥æ•è· HTTP è¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç ã€å“åº”æ—¶é—´ç­‰ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–å…¶ä»–ç›®æ ‡ï¼Œå¦‚æ–‡ä»¶æˆ–æ•°æ®åº“ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œé…ç½® Morgan æ¥è®°å½•ç‰¹å®šç±»å‹çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><p>Morgan æä¾›äº†å¤šç§é¢„å®šä¹‰çš„æ—¥å¿—æ ¼å¼ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œçµæ´»é…ç½®ã€‚é€šè¿‡ä½¿ç”¨ Morganï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°ç†è§£åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µï¼Œä¾¿äºè¿›è¡Œæ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const morgan = require(&#39;morgan&#39;)</span></span>
<span class="line"><span>app.use(morgan(&#39;dev&#39;))</span></span></code></pre></div><p>output</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[nodemon] starting `node app.js`</span></span>
<span class="line"><span>App running on port ${port}...</span></span>
<span class="line"><span>Hello from the middleware~ğŸ’­</span></span>
<span class="line"><span>2023-06-13T07:29:17.080Z</span></span>
<span class="line"><span>GET /api/v1/tours 200 3.714 ms - 8523</span></span></code></pre></div><p>å•ç‹¬è·¯ç”±app.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// routes</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tourRouter = express.Router();</span></span>
<span class="line"><span>const userRouter = express.Router();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tourRouter.route(&#39;/&#39;).get(getAllTours).post(createTour);</span></span>
<span class="line"><span>tourRouter.route(&#39;/:id&#39;).get(getTour).patch(updateTour).delete(deleteTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>userRouter.route(&#39;/&#39;).get(getAllUsers).post(createUser);</span></span>
<span class="line"><span>userRouter.route(&#39;/:id&#39;).get(getUser).patch(updateUser).delete(deleteUser);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use(&#39;/api/v1/tours&#39;, tourRouter);</span></span>
<span class="line"><span>app.use(&#39;/api/v1/users&#39;,userRouter)</span></span></code></pre></div><p>æ‹†åˆ†</p><p>controllers/tourController.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tours = JSON.parse(</span></span>
<span class="line"><span>    fs.readFileSync(`${__dirname}/../dev-data/data/tours-simple.json`)</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>exports.getAllTours = (req, res) =&gt; {</span></span>
<span class="line"><span>    console.log(req.requestTime);</span></span>
<span class="line"><span>    res.status(200).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      result: tours.length,</span></span>
<span class="line"><span>      data: {</span></span>
<span class="line"><span>        tours,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  };</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  exports.getTour = (req, res) =&gt; {</span></span>
<span class="line"><span>    console.log(req.params);</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    const id = req.params.id * 1; // it will then automatically convert that string to a number.</span></span>
<span class="line"><span>    if (id &gt; tours.length) {</span></span>
<span class="line"><span>      return res.status(404).json({</span></span>
<span class="line"><span>        status: &#39;fail&#39;,</span></span>
<span class="line"><span>        message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    const tour = tours.find((el) =&gt; el.id === id);</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    if (!tour) {</span></span>
<span class="line"><span>      return res.status(404).json({</span></span>
<span class="line"><span>        status: &#39;fail&#39;,</span></span>
<span class="line"><span>        message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    res.status(200).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      result: tours.length,</span></span>
<span class="line"><span>      data: {</span></span>
<span class="line"><span>        tour,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  };</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  exports.createTour = (req, res) =&gt; {</span></span>
<span class="line"><span>    const newId = tours[tours.length - 1].id + 1;</span></span>
<span class="line"><span>    const newTour = Object.assign({ id: newId }, req.body);</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    tours.push(newTour);</span></span>
<span class="line"><span>    fs.writeFile(</span></span>
<span class="line"><span>      `${__dirname}/dev-data/data/tours-simple.json`,</span></span>
<span class="line"><span>      JSON.stringify(tours),</span></span>
<span class="line"><span>      (err) =&gt; {</span></span>
<span class="line"><span>        res.status(201).json({</span></span>
<span class="line"><span>          status: &#39;success&#39;,</span></span>
<span class="line"><span>          data: {</span></span>
<span class="line"><span>            tours: newTour,</span></span>
<span class="line"><span>          },</span></span>
<span class="line"><span>        });</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>  };</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  exports.updateTour = (req, res) =&gt; {</span></span>
<span class="line"><span>    if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>      return res.status(404).json({</span></span>
<span class="line"><span>        status: &#39;fail&#39;,</span></span>
<span class="line"><span>        message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    res.status(200).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      data: {</span></span>
<span class="line"><span>        tour: &#39;&lt;Updated tour here&gt;&#39;,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  };</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  exports.deleteTour = (req, res) =&gt; {</span></span>
<span class="line"><span>    if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>      return res.status(404).json({</span></span>
<span class="line"><span>        status: &#39;fail&#39;,</span></span>
<span class="line"><span>        message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>      });</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    // And 204 means no content.</span></span>
<span class="line"><span>    res.status(204).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      data: null,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  };</span></span></code></pre></div><p>controllers/userController.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tours = JSON.parse(</span></span>
<span class="line"><span>    fs.readFileSync(`${__dirname}/../dev-data/data/tours-simple.json`)</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>exports.getAllUsers = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(500).json({</span></span>
<span class="line"><span>    status: &#39;error&#39;,</span></span>
<span class="line"><span>    message: &#39;This route is not yet definedğŸ¤–&#39;,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.createUser = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(500).json({</span></span>
<span class="line"><span>    status: &#39;error&#39;,</span></span>
<span class="line"><span>    message: &#39;This route is not yet definedğŸ¤–&#39;,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.updateUser = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(500).json({</span></span>
<span class="line"><span>    status: &#39;error&#39;,</span></span>
<span class="line"><span>    message: &#39;This route is not yet definedğŸ¤–&#39;,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.getUser = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(500).json({</span></span>
<span class="line"><span>    status: &#39;error&#39;,</span></span>
<span class="line"><span>    message: &#39;This route is not yet definedğŸ¤–&#39;,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.deleteUser = (req, res) =&gt; {</span></span>
<span class="line"><span>  res.status(500).json({</span></span>
<span class="line"><span>    status: &#39;error&#39;,</span></span>
<span class="line"><span>    message: &#39;This route is not yet definedğŸ¤–&#39;,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>routes/tourRoutes.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const tourController = require(&#39;./../controllers/tourController&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const router = express.Router();</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>router.route(&#39;/&#39;).get(tourController.getAllTours).post(tourController.createTour);</span></span>
<span class="line"><span>router.route(&#39;/:id&#39;).get(tourController.getTour).patch(tourController.updateTour).delete(tourController.deleteTour);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = router;</span></span></code></pre></div><p>routes/userRoutes.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const userController = require(&#39;./../controllers/userController&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const router = express.Router();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>router.route(&#39;/&#39;).get(userController.getAllUsers).post(userController.createUser);</span></span>
<span class="line"><span>router.route(&#39;/:id&#39;).get(userController.getUser).patch(userController.updateUser).delete(userController.deleteUser);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = router;</span></span></code></pre></div><p>app.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const morgan = require(&#39;morgan&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const app = express();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tourRouter = require(&#39;./routes/tourRoutes&#39;);</span></span>
<span class="line"><span>const userRouter = require(&#39;./routes/userRoutes&#39;);</span></span>
<span class="line"><span>//  middleware</span></span>
<span class="line"><span>app.use(morgan(&#39;dev&#39;));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use(express.json());</span></span>
<span class="line"><span>app.use((req, res, next) =&gt; {</span></span>
<span class="line"><span>  console.log(&#39;Hello from the middleware~ğŸ’­&#39;);</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use((req, res, next) =&gt; {</span></span>
<span class="line"><span>  req.requestTime = new Date().toISOString();</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use(&#39;/api/v1/tours&#39;, tourRouter);</span></span>
<span class="line"><span>app.use(&#39;/api/v1/users&#39;, userRouter);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = app</span></span></code></pre></div><p>server.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const app = require(&#39;./app&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// server</span></span>
<span class="line"><span>const port = 3000;</span></span>
<span class="line"><span>app.listen(port, () =&gt; {</span></span>
<span class="line"><span>  console.log(&#39;App running on port ${port}...&#39;);</span></span>
<span class="line"><span>});</span></span></code></pre></div><p>packge.json</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;name&quot;: &quot;4-express&quot;,</span></span>
<span class="line"><span>  &quot;version&quot;: &quot;1.0.0&quot;,</span></span>
<span class="line"><span>  &quot;description&quot;: &quot;&quot;,</span></span>
<span class="line"><span>  &quot;main&quot;: &quot;index.js&quot;,</span></span>
<span class="line"><span>  &quot;scripts&quot;: {</span></span>
<span class="line"><span>    &quot;start&quot;: &quot;nodemon server.js&quot;</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  &quot;author&quot;: &quot;&quot;,</span></span>
<span class="line"><span>  &quot;license&quot;: &quot;ISC&quot;,</span></span>
<span class="line"><span>  &quot;dependencies&quot;: {</span></span>
<span class="line"><span>    &quot;express&quot;: &quot;^4.18.2&quot;,</span></span>
<span class="line"><span>    &quot;morgan&quot;: &quot;^1.10.0&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>tourController.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>exports.checkId = (req, res, next, val) =&gt; {</span></span>
<span class="line"><span>  if (req.params.id * 1 &gt; tours.length) {</span></span>
<span class="line"><span>    return res.status(404).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: &#39;Invalid ID&#39;,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>npm i dotenv</p><p>p66</p><p>&#39;NODE_ENV&#39; ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº æˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚ è§£å†³åŠæ³• windowsç¯å¢ƒ è¦å…ˆå®‰è£… cross-env npm install cross-env -D ä¿®æ”¹ä¸º</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;scripts&quot;: {</span></span>
<span class="line"><span>    &quot;start:dev&quot;: &quot;nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;start:prod&quot;: &quot;NODE_ENV=production nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;build&quot;: &quot;cross-env NODE_ENV=production nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;dev&quot;: &quot;cross-env NODE_ENV=development nodemon server.js&quot;</span></span>
<span class="line"><span>  },</span></span></code></pre></div><p><a href="https://eslint.org/" target="_blank" rel="noreferrer">https://eslint.org/</a></p><p>npm install eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-config-airbnb eslint-plugin-node eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react --save-dev</p><p>è®©æˆ‘é€ä¸ªè§£é‡Šè¿™äº›ä¾èµ–é¡¹çš„ä½œç”¨ï¼š</p><ol><li><code>eslint</code>: ESLint æ˜¯ä¸€ä¸ªç”¨äºæ£€æŸ¥å’Œè§„èŒƒ JavaScript ä»£ç çš„å·¥å…·ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ•è·æ½œåœ¨çš„é—®é¢˜å’Œé”™è¯¯ï¼Œå¹¶ç¡®ä¿ä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚</li><li><code>prettier</code>: Prettier æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆä¸€è‡´çš„é£æ ¼è§„èŒƒã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æ¶ˆé™¤å›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„ä»£ç é£æ ¼å·®å¼‚ï¼Œä½¿ä»£ç æ›´åŠ æ˜“è¯»å’Œä¸€è‡´ã€‚</li><li><code>eslint-config-prettier</code>: è¿™æ˜¯ä¸€ä¸ª ESLint é…ç½®ï¼Œç”¨äºç¦ç”¨ä¸ Prettier ç›¸å†²çªçš„ ESLint è§„åˆ™ï¼Œä»¥ä¾¿äºŒè€…å¯ä»¥ä¸€èµ·ä½¿ç”¨è€Œä¸äº§ç”Ÿå†²çªã€‚</li><li><code>eslint-plugin-prettier</code>: è¿™æ˜¯ä¸€ä¸ª ESLint æ’ä»¶ï¼Œç”¨äºå°† Prettier åº”ç”¨ä¸º ESLint è§„åˆ™ï¼Œå¹¶åœ¨éœ€è¦æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ã€‚</li><li><code>eslint-config-airbnb</code>: è¿™æ˜¯ä¸€ä¸ªç”± Airbnb å…¬å¸æä¾›çš„ ESLint é…ç½®ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—ç”¨äº JavaScript ä»£ç çš„è§„èŒƒã€‚å®ƒåŒ…å«äº†è®¸å¤šæœ€ä½³å®è·µå’Œå¸¸è§çš„ä»£ç é£æ ¼è§„åˆ™ã€‚</li><li><code>eslint-plugin-node</code>: è¿™æ˜¯ä¸€ä¸ª ESLint æ’ä»¶ï¼Œæä¾›äº†ç”¨äºæ£€æŸ¥ Node.js ä»£ç çš„è§„åˆ™é›†ã€‚å®ƒåŒ…å«äº†è®¸å¤šä¸ Node.js ç›¸å…³çš„æœ€ä½³å®è·µå’Œè§„èŒƒã€‚</li><li><code>eslint-plugin-import</code>: è¿™æ˜¯ä¸€ä¸ª ESLint æ’ä»¶ï¼Œæä¾›äº†ç”¨äºæ£€æŸ¥å’Œè§„èŒƒ ES6 æ¨¡å—å¯¼å…¥è¯­æ³•çš„è§„åˆ™ã€‚</li><li><code>eslint-plugin-jsx-a11y</code>: è¿™æ˜¯ä¸€ä¸ª ESLint æ’ä»¶ï¼Œæä¾›äº†ç”¨äºæ£€æŸ¥å’Œè§„èŒƒ JSX å…ƒç´ çš„å¯è®¿é—®æ€§ç›¸å…³è§„åˆ™ã€‚å®ƒæœ‰åŠ©äºç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºä¸­çš„ç”¨æˆ·ç•Œé¢å¯¹äºä¸åŒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®å’Œä½¿ç”¨ã€‚</li><li><code>eslint-plugin-react</code>: è¿™æ˜¯ä¸€ä¸ª ESLint æ’ä»¶ï¼Œæä¾›äº†ç”¨äºæ£€æŸ¥å’Œè§„èŒƒ React ç»„ä»¶çš„è§„åˆ™ã€‚å®ƒåŒ…å«äº†è®¸å¤šä¸ React å¼€å‘ç›¸å…³çš„æœ€ä½³å®è·µå’Œè§„èŒƒã€‚</li></ol><h2 id="mongodb" tabindex="-1">mongoDB <a class="header-anchor" href="#mongodb" aria-label="Permalink to &quot;mongoDB&quot;">â€‹</a></h2><p>KEY MONGODB FEATURES: Document based:MongoDB stores data in documents (field-value pair data structures,NoSQL); Scalable:Very easy to distribute data across multiple machines as your users and amount of data grows; Flexible:No document data schema required,so each document can have different number and type of fields; Performant:Embedded data models,indexing,sharding,flexible documents,native duplication,etc. Free and open-source,published under the SSPL License.</p><p><a href="https://www.mongodb.com/try/download/compass" target="_blank" rel="noreferrer">https://www.mongodb.com/try/download/compass</a></p><p>é…ç½®ç¯å¢ƒå˜é‡</p><p>&#39;mongod.exe&#39; ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº æˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚</p><p>ç¡®ä¿æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥å’Œè®¾ç½® MongoDB çš„ç¯å¢ƒå˜é‡ï¼š</p><ol><li>æ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®ï¼š <ul><li>åœ¨ Windows ä¸Šï¼ŒæŒ‰ä¸‹ Win + X é”®ï¼Œç„¶åé€‰æ‹© &quot;ç³»ç»Ÿ&quot;ã€‚</li><li>åœ¨ &quot;ç³»ç»Ÿ&quot; çª—å£ä¸­ï¼Œç‚¹å‡»å·¦ä¾§çš„ &quot;é«˜çº§ç³»ç»Ÿè®¾ç½®&quot;ã€‚</li><li>åœ¨ &quot;ç³»ç»Ÿå±æ€§&quot; çª—å£ä¸­ï¼Œç‚¹å‡» &quot;é«˜çº§&quot; é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡» &quot;ç¯å¢ƒå˜é‡&quot; æŒ‰é’®ã€‚</li></ul></li><li>ç¼–è¾‘ç³»ç»Ÿçš„ PATH å˜é‡ï¼š <ul><li>åœ¨ &quot;ç¯å¢ƒå˜é‡&quot; çª—å£ä¸­ï¼Œæ‰¾åˆ° &quot;ç³»ç»Ÿå˜é‡&quot; éƒ¨åˆ†ï¼ŒæŸ¥æ‰¾åä¸º &quot;Path&quot; æˆ– &quot;PATH&quot; çš„å˜é‡ã€‚</li><li>é€‰ä¸­ &quot;Path&quot; å˜é‡ï¼Œç„¶åç‚¹å‡» &quot;ç¼–è¾‘&quot;ã€‚</li></ul></li><li>æ·»åŠ  MongoDB çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼š <ul><li>åœ¨ &quot;ç¼–è¾‘ç¯å¢ƒå˜é‡&quot; çª—å£ä¸­ï¼Œç‚¹å‡» &quot;æ–°å»º&quot;ã€‚</li><li>åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥ MongoDB çš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ç±»ä¼¼äº <code>C:\Program Files\MongoDB\Server\{version}\bin</code>ï¼Œå…¶ä¸­ <code>{version}</code> æ˜¯ä½ å®‰è£…çš„ MongoDB ç‰ˆæœ¬å·ã€‚</li><li>ç¡®è®¤æ·»åŠ è·¯å¾„åï¼Œç‚¹å‡» &quot;ç¡®å®š&quot; å…³é—­æ‰€æœ‰æ‰“å¼€çš„çª—å£ã€‚</li></ul></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; use natours-test</span></span>
<span class="line"><span>switched to db natours-test</span></span>
<span class="line"><span>&gt; db.tours.insertOne({ name:&quot;The Forest Hiker&quot;, price:297, rating: 4.7})</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>        &quot;acknowledged&quot; : true,</span></span>
<span class="line"><span>        &quot;insertedId&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;)</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>&gt; show dbs</span></span>
<span class="line"><span>admin         0.000GB</span></span>
<span class="line"><span>config        0.000GB</span></span>
<span class="line"><span>local         0.000GB</span></span>
<span class="line"><span>natours-test  0.000GB</span></span>
<span class="line"><span>&gt; show collections</span></span>
<span class="line"><span>tours</span></span>
<span class="line"><span>&gt; quit()</span></span></code></pre></div><p>db.tours.insertMany([{ name:&quot;The Sea Explorer&quot;, price:497, rating:4.8 },{ name:&quot;The Show Adventurer&quot;, price:997,rating:4.9,difficulty:&quot;easy&quot;}])</p><p>Ite stands for less thanï¼ŒWhere the price is less than 500.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>C:\Users\lxwei&gt;mongo</span></span>
<span class="line"><span>MongoDB shell version v4.0.28</span></span>
<span class="line"><span>connecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb</span></span>
<span class="line"><span>Implicit session: session { &quot;id&quot; : UUID(&quot;a7865479-8885-4277-a4cf-517c54960ce2&quot;) }</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 997, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot; }</span></span>
<span class="line"><span>&gt; db.tours.find({ name:&quot;The Forest Hiker&quot;})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>&gt; db.tours.find({ price:{$lte:500}})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>&gt; db.tours.find({ price: {$lt:500}, rating: {$gte: 4.8}})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>&gt; db.tours.find({ $or: [ {price: {$lt:500}}, {rating: {$gte:4.8}}]})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 997, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot; }</span></span>
<span class="line"><span>&gt; db.tours.find({ $or: [ {price: {$gt:500}}, {rating: {$gte:4.8}}]})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 997, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot; }</span></span>
<span class="line"><span>&gt; db.tours.find({ $or: [ {price: {$gt:500}}, {rating: {$gte:4.8}}]},{name:1})</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot; }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot; }</span></span>
<span class="line"><span>&gt;</span></span></code></pre></div><p>update</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; db.tours.updateOne({ name:&quot;The Snow Adventurer&quot;}, {$set: {price:597}})</span></span>
<span class="line"><span>{ &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 0, &quot;modifiedCount&quot; : 0 }</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 997, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot; }</span></span>
<span class="line"><span>&gt; db.tours.updateOne({ name:&quot;The Show Adventurer&quot;}, {$set: {price:597}})</span></span>
<span class="line"><span>{ &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 1, &quot;modifiedCount&quot; : 1 }</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 597, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot; }</span></span>
<span class="line"><span>&gt; db.tours.updateMany({ price:{$gt:500}, rating: {$gte: 4.8}}, {$set:{premium:true}})</span></span>
<span class="line"><span>{ &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 1, &quot;modifiedCount&quot; : 1 }</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 597, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot;, &quot;premium&quot; : true }</span></span>
<span class="line"><span>&gt;</span></span></code></pre></div><p>delete</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;6489852da6dc8f37d4425eb2&quot;), &quot;name&quot; : &quot;The Forest Hiker&quot;, &quot;price&quot; : 297, &quot;rating&quot; : 4.7 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 597, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot;, &quot;premium&quot; : true }</span></span>
<span class="line"><span>&gt; db.tours.deleteMany({ rating:{$lt:4.8}})</span></span>
<span class="line"><span>{ &quot;acknowledged&quot; : true, &quot;deletedCount&quot; : 1 }</span></span>
<span class="line"><span>&gt; db.tours.find()</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4e&quot;), &quot;name&quot; : &quot;The Sea Explorer&quot;, &quot;price&quot; : 497, &quot;rating&quot; : 4.8 }</span></span>
<span class="line"><span>{ &quot;_id&quot; : ObjectId(&quot;648988b8cdc7e83a9245ef4f&quot;), &quot;name&quot; : &quot;The Show Adventurer&quot;, &quot;price&quot; : 597, &quot;rating&quot; : 4.9, &quot;difficulty&quot; : &quot;easy&quot;, &quot;premium&quot; : true }</span></span>
<span class="line"><span>&gt;</span></span></code></pre></div><p>p79-80 åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mongodb.com%2Fatlas%2Fdatabase" target="_blank" rel="noreferrer">MongoDB Atlas</a>åˆ›å»ºå¹¶ç™»å½•åˆ°ä½ çš„è´¦æˆ·ï¼ŒAtlas ä¼šå»ºè®®ä½ åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œæ¥ç€ç”¨</p><ul><li><em>database access</em>é€‰é¡¹å¡ä¸ºæ•°æ®åº“åˆ›å»ºç”¨æˆ·å‡­æ®ï¼Œå¯ä»¥è®©ä½ çš„åº”ç”¨è¿æ¥åˆ°æ•°æ®åº“</li><li><em><strong>Network access</strong></em>å®šä¹‰å…è®¸è®¿é—®æ•°æ®åº“çš„ IP åœ°å€ã€‚æ–¹ä¾¿èµ·è§è®¾ä¸º0.0.0.0/0ï¼Œè¡¨ç¤º Anywhere</li></ul><p>&quot;mongodb+srv://cluster0.ngazdya.mongodb.net/&quot; --username chloe2099 MongoDB shell version v4.0.28 Enter password:</p><p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¯†ç æ—¶ï¼Œé€šå¸¸ä¸ä¼šæ˜¾ç¤ºå¯†ç å­—ç¬¦æˆ–æ˜Ÿå·ï¼Œè¿™æ˜¯ä¸ºäº†ä¿æŠ¤å¯†ç çš„å®‰å…¨æ€§ã€‚æ‰€ä»¥ï¼Œå½“ä½ è¾“å…¥å¯†ç æ—¶ï¼Œå±å¹•ä¸Šä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œä½†å®é™…ä¸Šå¯†ç æ˜¯è¢«è¾“å…¥çš„ã€‚</p><p>è¯·æ³¨æ„ï¼Œå³ä½¿æ²¡æœ‰æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œä½ ä»ç„¶å¯ä»¥è¾“å…¥å¯†ç ã€‚åªéœ€é”®å…¥å¯†ç å¹¶æŒ‰ä¸‹å›è½¦é”®ï¼Œ</p><p>ä¸¤ç§æ–¹æ³•é“¾æ¥</p><p>1.compass</p><p>2.shell</p><p>config.env</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">development</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mongodb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">srv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//chloe2099:&lt;PASSWORD&gt;@cluster0.ngazdya.mongodb.net/natours?retryWrites=true&amp;w=majority</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE_LOCAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mongodb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//localhost:27017/natours</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATABASE_PASSWORD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1yaXusiP3MF1LbmV</span></span></code></pre></div><p>npm i mongoose@5</p><p><a href="https://mongoosejs.com/docs/index.html" target="_blank" rel="noreferrer">https://mongoosejs.com/docs/index.html</a></p><p>tourController.js</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Tour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;../models/tourModel&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tours</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">__dirname</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}/../dev-data/data/tours-simple.json`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (req.params.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tours.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Invalid ID&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAllTours</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // console.log(req.requestTime);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tours</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// So find is to find all of the documents.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result: tours.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tours,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: err,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.params.id); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// to find only one document</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // So this here would work the exact same way as this,okay?</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Tour.findOne({ _id:req.params.id})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      result: tours.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tour,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: err,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> newTour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.body);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">201</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tours: newTour,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: err,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateTour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findByIdAndUpdate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.params.id, req.body, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      new: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tour,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: err,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">deleteTour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findByIdAndDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(req.params.id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">204</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;success&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      data: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      status: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: err,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div><p>tourModel.js</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mongoose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mongoose&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tourSchema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mongoose.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: String,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      require: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;A tour must have a name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      unique: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rating: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: Number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      default: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    price: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      type: Number,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      require: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;A tour must have a price&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Tour</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mongoose.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Tour&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tourSchema);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tour</span></span></code></pre></div><p><a href="https://www.natours.dev/api/v1/tours" target="_blank" rel="noreferrer">https://www.natours.dev/api/v1/tours</a></p><p><code>process.argv</code> æ˜¯ä¸€ä¸ªå­˜å‚¨å‘½ä»¤è¡Œå‚æ•°çš„æ•°ç»„ã€‚å®ƒåŒ…å«äº†åœ¨å¯åŠ¨ Node.js è„šæœ¬æ—¶ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><p>åœ¨ä½ çš„è¾“å‡ºä¸­ï¼Œ<code>process.argv</code> çš„å€¼æ˜¯ï¼š</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;C:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Program Files</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nodejs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node.exe&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;D:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learn-node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learn-node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">project</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">4-express</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dev-data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">data</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">import-dev-data.js&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ Node.js è§£é‡Šå™¨çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä½ è¿è¡Œçš„è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>è¿™åœ¨ä½ çš„è„šæœ¬ä¸­å¯èƒ½æœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥å®šåˆ¶è„šæœ¬çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ï¼Œç„¶ååœ¨è„šæœ¬ä¸­ä½¿ç”¨è¿™ä¸ªè·¯å¾„æ¥è¯»å–æ–‡ä»¶æˆ–æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚</p><p>åœ¨ä½ çš„ä»£ç ä¸­ï¼Œä¼¼ä¹å¹¶æ²¡æœ‰ä½¿ç”¨ <code>process.argv</code>ï¼Œæ‰€ä»¥å®ƒåœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å¯èƒ½æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦åœ¨è„šæœ¬ä¸­ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—® <code>process.argv</code> æ•°ç»„æ¥è·å–å®ƒä»¬ã€‚</p><p>import-dev-data.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const fs = require(&#39;fs&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const mongoose = require(&#39;mongoose&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const dotenv = require(&#39;dotenv&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const Tour = require(&#39;./../../models/tourModel&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>dotenv.config({ path: &#39;./config.env&#39; });</span></span>
<span class="line"><span>// console.log(process.env);</span></span>
<span class="line"><span>const DB = process.env.DATABASE.replace(</span></span>
<span class="line"><span>  &#39;&lt;PASSWORD&gt;&#39;,</span></span>
<span class="line"><span>  process.env.DATABASE_PASSWORD</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span>mongoose</span></span>
<span class="line"><span>  // .connect(process.env.DATABASE_LOCAL, {</span></span>
<span class="line"><span>  .connect(DB, {</span></span>
<span class="line"><span>    useNewUrlParser: true,</span></span>
<span class="line"><span>    useCreateIndex: true,</span></span>
<span class="line"><span>    useFindAndModify: false</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  .then(() =&gt; </span></span>
<span class="line"><span>    console.log(&#39;DB connection successful~ğŸ±&#39;)</span></span>
<span class="line"><span>  );</span></span>
<span class="line"><span>  console.log(`${__dirname}/tours-simple.json`,&#39;ğŸ¤£&#39;);</span></span>
<span class="line"><span>//   read json file</span></span>
<span class="line"><span>const tours = JSON.parse(fs.readFileSync(`${__dirname}/tours-simple.json`, &#39;utf-8&#39;)); //this dot here is always relative from the folder</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// import data into db</span></span>
<span class="line"><span>const importData = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    await Tour.create(tours);</span></span>
<span class="line"><span>    console.log(&#39;Data successfully loaded~ğŸ˜€&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// delete all data from db</span></span>
<span class="line"><span>const deleteData = async () =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    await Tour.deleteMany()</span></span>
<span class="line"><span>    console.log(&#39;Data successfully deleted&#39;);</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    console.log(err);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>if (process.argv[2] === &#39;--import&#39;) {</span></span>
<span class="line"><span>  importData()</span></span>
<span class="line"><span>} else if (process.argv[2] === &#39;--delete&#39;){</span></span>
<span class="line"><span>  deleteData();</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>console.log(process.argv);</span></span></code></pre></div><p>utils/apiFeatures.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>class APIFeatures {</span></span>
<span class="line"><span>    constructor(query, queryString) {</span></span>
<span class="line"><span>      this.query = query;</span></span>
<span class="line"><span>      this.queryString = queryString;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    filter() {</span></span>
<span class="line"><span>      // 1) filtering</span></span>
<span class="line"><span>      const queryObj = { ...this.queryString };</span></span>
<span class="line"><span>      const excludeFields = [&#39;page&#39;, &#39;sort&#39;, &#39;limit&#39;, &#39;fields&#39;];</span></span>
<span class="line"><span>      excludeFields.forEach(el =&gt; delete queryObj[el]);</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>      // 2)advanced filtering</span></span>
<span class="line"><span>      let queryStr = JSON.stringify(queryObj);</span></span>
<span class="line"><span>      queryStr = queryStr.replace(/\b(gte|gt|lte|lt)\b/g, match =&gt; `$${match}`);</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>      this.query.find(JSON.parse(queryStr)); // So find is to find all of the documents.</span></span>
<span class="line"><span>      return this;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    sort() {</span></span>
<span class="line"><span>      // 3)sort</span></span>
<span class="line"><span>      if (this.queryString.sort) {</span></span>
<span class="line"><span>        // we sorted them by the price in an ascending order. 127.0.0.1:3000/api/v1/tours?sort=price</span></span>
<span class="line"><span>        // But we can also sort them in a descending order. 127.0.0.1:3000/api/v1/tours?sort=-price</span></span>
<span class="line"><span>        const sortBy = this.queryString.sort.split(&#39;,&#39;).join(&#39; &#39;);</span></span>
<span class="line"><span>        this.query = this.query.sort(sortBy);</span></span>
<span class="line"><span>      } else {</span></span>
<span class="line"><span>        this.query = this.query.sort(&#39;-createdAt&#39;);</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>      return this;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    limitFields() {</span></span>
<span class="line"><span>      // 4)field limit</span></span>
<span class="line"><span>      if (this.queryString.fields) {</span></span>
<span class="line"><span>        const fields = this.queryString.fields.split(&#39;,&#39;).join(&#39; &#39;);</span></span>
<span class="line"><span>        this.query = this.query.select(fields);</span></span>
<span class="line"><span>      } else {</span></span>
<span class="line"><span>        this.query = this.query.select(&#39;-__v&#39;);</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>      return this;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>    pagination() {</span></span>
<span class="line"><span>      // 5)pagination</span></span>
<span class="line"><span>      const page = this.queryString.page * 1 || 1;</span></span>
<span class="line"><span>      const limit = this.queryString.limit * 1 || 100;</span></span>
<span class="line"><span>      const skip = (page - 1) * limit;</span></span>
<span class="line"><span>      this.query = this.query.skip(skip).limit(limit);</span></span>
<span class="line"><span>      return this;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  module.exports = APIFeatures</span></span></code></pre></div><p>p100</p><p>å½“ä½¿ç”¨MongoDBè¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>find()</code>æ–¹æ³•æ¥æ£€ç´¢æ–‡æ¡£ã€‚ç„¶è€Œï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œå¦‚åˆ†ç»„ã€æ’åºã€ç»Ÿè®¡ç­‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨MongoDBçš„èšåˆæ¡†æ¶æ¥è¿›è¡Œæ•°æ®èšåˆæ“ä½œã€‚</p><p><code>aggregate()</code>æ–¹æ³•æ˜¯MongoDBæä¾›çš„ä¸€ä¸ªèšåˆæ“ä½œå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåŒ…å«å¤šä¸ªèšåˆç®¡é“æ“ä½œç¬¦çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œæ¯ä¸ªæ“ä½œç¬¦ä»£è¡¨ä¸€ä¸ªèšåˆé˜¶æ®µã€‚é€šè¿‡è¿æ¥å¤šä¸ªèšåˆé˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªå®šä¹‰çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†å’Œåˆ†æã€‚</p><p>èšåˆç®¡é“æ“ä½œç¬¦æ˜¯åœ¨èšåˆé˜¶æ®µä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ“ä½œç¬¦ï¼Œç”¨äºæ‰§è¡Œå„ç§æ•°æ®è½¬æ¢å’Œè®¡ç®—æ“ä½œã€‚ä¸€äº›å¸¸ç”¨çš„èšåˆç®¡é“æ“ä½œç¬¦åŒ…æ‹¬ï¼š</p><ul><li><code>$match</code>: ç”¨äºç­›é€‰æ–‡æ¡£ï¼Œç±»ä¼¼äº<code>find()</code>æ–¹æ³•ä¸­çš„æŸ¥è¯¢æ¡ä»¶ã€‚</li><li><code>$group</code>: ç”¨äºå¯¹æ–‡æ¡£è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œå¹¶è¿›è¡Œèšåˆè®¡ç®—ã€‚</li><li><code>$sort</code>: ç”¨äºå¯¹æ–‡æ¡£è¿›è¡Œæ’åºæ“ä½œã€‚</li><li><code>$project</code>: ç”¨äºæŠ•å½±æ“ä½œï¼Œé€‰æ‹©éœ€è¦è¿”å›çš„å­—æ®µã€‚</li><li><code>$limit</code>: ç”¨äºé™åˆ¶è¿”å›çš„æ–‡æ¡£æ•°é‡ã€‚</li><li><code>$skip</code>: ç”¨äºè·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ã€‚</li></ul><p>åœ¨ç»™å®šçš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œ<code>aggregate()</code>æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¼ å…¥äº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªèšåˆé˜¶æ®µçš„æ•°ç»„ã€‚é¦–å…ˆï¼Œä½¿ç”¨<code>$match</code>æ“ä½œç¬¦ç­›é€‰å‡º<code>ratingAverage</code>å­—æ®µå¤§äºç­‰äº4.5çš„æ–‡æ¡£ï¼Œç„¶åä½¿ç”¨<code>$group</code>æ“ä½œç¬¦å¯¹ç»“æœè¿›è¡Œåˆ†ç»„å’Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ç»„ç»Ÿè®¡æ•°æ®ã€‚</p><p>èšåˆæ“ä½œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«ç¬¦åˆèšåˆç®¡é“æ“ä½œçš„æ–‡æ¡£æˆ–è®¡ç®—ç»“æœã€‚åœ¨ä»£ç ä¸­ï¼Œé€šè¿‡å°†èšåˆæ“ä½œçš„ç»“æœèµ‹å€¼ç»™<code>stats</code>å˜é‡ï¼Œç„¶åå°†å…¶ä½œä¸ºJSONå“åº”çš„ä¸€éƒ¨åˆ†è¿”å›ç»™è°ƒç”¨è€…ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>exports.getTourStats = async (req, res) =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const stats = await Tour.aggregate([</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $match: { ratingsAverage: { $gte: 4.5 } },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $group: {</span></span>
<span class="line"><span>          _id: null,</span></span>
<span class="line"><span>          num:{ $sum:1},</span></span>
<span class="line"><span>          numRating: { $sum: &#39;$ratingsQuantity&#39; },</span></span>
<span class="line"><span>          avgRating: { $avg: &#39;$ratingsAverage&#39; },</span></span>
<span class="line"><span>          avgPrice: { $avg: &#39;$price&#39; },</span></span>
<span class="line"><span>          minPrice: { $min: &#39;$price&#39; },</span></span>
<span class="line"><span>          maxPrice: { $max: &#39;$price&#39; },</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    ]);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    res.status(200).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      data: {</span></span>
<span class="line"><span>        stats,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    res.status(400).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: err,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>};</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>exports.getMonthlyPlan = async (req, res) =&gt; {</span></span>
<span class="line"><span>  try {</span></span>
<span class="line"><span>    const year = req.params.year * 1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const plan = await Tour.aggregate([</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $unwind: &#39;$startDates&#39;,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $match: {</span></span>
<span class="line"><span>          startDates: {</span></span>
<span class="line"><span>            $gte: new Date(`${year}-01-01`),</span></span>
<span class="line"><span>            $lte: new Date(`${year}-12-31`),</span></span>
<span class="line"><span>          }, //So basically,excluding the one that says easy,right?</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $group: {</span></span>
<span class="line"><span>          _id: { $month: &#39;$startDates&#39; },</span></span>
<span class="line"><span>          numTourStarts: { $sum: 1 },</span></span>
<span class="line"><span>          tours: { $push: &#39;$name&#39; },</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $addFields: {</span></span>
<span class="line"><span>          month: &#39;$_id&#39;,</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $project: {</span></span>
<span class="line"><span>          _id: 0,</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $sort: {</span></span>
<span class="line"><span>          numTourStarts: -1, // So starting with the highest number.</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      {</span></span>
<span class="line"><span>        $limit: 6,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    ]);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    res.status(200).json({</span></span>
<span class="line"><span>      status: &#39;success&#39;,</span></span>
<span class="line"><span>      data: {</span></span>
<span class="line"><span>        plan,</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  } catch (err) {</span></span>
<span class="line"><span>    res.status(400).json({</span></span>
<span class="line"><span>      status: &#39;fail&#39;,</span></span>
<span class="line"><span>      message: err,</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>npm i slugify</p><p>npm i validator</p><p><a href="https://www.npmjs.com/package/validator" target="_blank" rel="noreferrer">https://www.npmjs.com/package/validator</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const mongoose = require(&#39;mongoose&#39;);</span></span>
<span class="line"><span>const slugify = require(&#39;slugify&#39;);</span></span>
<span class="line"><span>const validator = require(&#39;validator&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tourSchema = new mongoose.Schema(</span></span>
<span class="line"><span>  {</span></span>
<span class="line"><span>    name: {</span></span>
<span class="line"><span>      type: String,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a name&#39;],</span></span>
<span class="line"><span>      unique: true,</span></span>
<span class="line"><span>      trim:true,</span></span>
<span class="line"><span>      maxlength:[40,&#39;A tour must have less or equal then 40 characters&#39;],</span></span>
<span class="line"><span>      minlength:[10,&#39;A tour must have more or equal then 40 characters&#39;],</span></span>
<span class="line"><span>      validate:[validator.isAlpha,&#39;Tour name must only contain characters&#39;]</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    slug: String,</span></span>
<span class="line"><span>    duration: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a duration&#39;],</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    maxGroupSize: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a group size&#39;],</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    difficulty: {</span></span>
<span class="line"><span>      type: String,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a difficulty&#39;],</span></span>
<span class="line"><span>      enum:{</span></span>
<span class="line"><span>        values:[&#39;easy&#39;,&#39;medium&#39;,&#39;difficulty&#39;],</span></span>
<span class="line"><span>        message:&#39;Difficulty is either:easy,medium,difficult&#39;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    ratingsAverage: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      default: 4.5,</span></span>
<span class="line"><span>      min:[1,&#39;Rating must be above 1.0&#39;],</span></span>
<span class="line"><span>      max:[5,&#39;Rating must be below 5.0&#39;]</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    ratingsQuantity: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      default: 0,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    price: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a price&#39;],</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    priceDiscount: {</span></span>
<span class="line"><span>      type: Number,</span></span>
<span class="line"><span>      validate:{</span></span>
<span class="line"><span>        validator:function(val) {</span></span>
<span class="line"><span>          // THIS ONLY POINTS TO CURRENT DOC on NEWdocument creation</span></span>
<span class="line"><span>          return val &lt; this.price</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        message:&#39;Discount price {{VALUE}} should be below regular price&#39;</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    summary: {</span></span>
<span class="line"><span>      type: String,</span></span>
<span class="line"><span>      trim: true, // which will remove all the white space</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a summary&#39;],</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    description: {</span></span>
<span class="line"><span>      type: String,</span></span>
<span class="line"><span>      trim: true, // which will remove all the white space</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    imageCover: {</span></span>
<span class="line"><span>      type: String,</span></span>
<span class="line"><span>      required: [true, &#39;A tour must have a imageCover&#39;],</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    images: [String], //So an array in which we have a number of strings.</span></span>
<span class="line"><span>    createAt: {</span></span>
<span class="line"><span>      type: Date,</span></span>
<span class="line"><span>      default: Date.now(), //that&#39;s the automatically created timestamp</span></span>
<span class="line"><span>      select: false,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    startDates: [Date],</span></span>
<span class="line"><span>    secretTour: {</span></span>
<span class="line"><span>      type: Boolean,</span></span>
<span class="line"><span>      default: false,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  {</span></span>
<span class="line"><span>    toJSON: {</span></span>
<span class="line"><span>      virtuals: true,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    toObject: {</span></span>
<span class="line"><span>      virtuals: true,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tourSchema.virtual(&#39;durationWeeks&#39;).get(function () {</span></span>
<span class="line"><span>  return this.duration / 7;</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// document middleware : runs before .save() and .create()</span></span>
<span class="line"><span>tourSchema.pre(&#39;save&#39;, function (next) {</span></span>
<span class="line"><span>  // this is the currently processed document.</span></span>
<span class="line"><span>  this.slug = slugify(this.name, { lower: true });</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// query middleware</span></span>
<span class="line"><span>// and so all of these will now actually trigger</span></span>
<span class="line"><span>tourSchema.pre(/^find/, function (next) {</span></span>
<span class="line"><span>  // tourSchema.pre(&#39;find&#39;, function (next) {</span></span>
<span class="line"><span>  this.find({ secretTour: { $ne: true } });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  this.start = Date.now();</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tourSchema.post(/^find/, function (docs, next) {</span></span>
<span class="line"><span>  console.log(`Query took ${Date.now() - this.start} milliseconds!`);</span></span>
<span class="line"><span>  // console.log(docs);</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// aggregation middleware</span></span>
<span class="line"><span>// before or after an aggregation happens</span></span>
<span class="line"><span>tourSchema.pre(&#39;aggregate&#39;, function (next) {</span></span>
<span class="line"><span>  // this is going to point to the current aggregation object.</span></span>
<span class="line"><span>  this.pipeline().unshift({ $match: { secretTour: { $ne: true } } });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const Tour = mongoose.model(&#39;Tour&#39;, tourSchema);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = Tour;</span></span></code></pre></div><p>npm i ndb --global</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;scripts&quot;: {</span></span>
<span class="line"><span>    &quot;start:dev&quot;: &quot;nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;start:prod&quot;: &quot;NODE_ENV=production nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;build&quot;: &quot;cross-env NODE_ENV=production nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;dev&quot;: &quot;cross-env NODE_ENV=development nodemon server.js&quot;,</span></span>
<span class="line"><span>    &quot;debug&quot;:&quot;ndb server.js&quot;</span></span>
<span class="line"><span>  },</span></span></code></pre></div><p>npm run debug</p><p>app.jsè¿”å›é”™è¯¯</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const express = require(&#39;express&#39;);</span></span>
<span class="line"><span>const morgan = require(&#39;morgan&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const tourRouter = require(&#39;./routes/tourRoutes&#39;);</span></span>
<span class="line"><span>const userRouter = require(&#39;./routes/userRoutes&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const app = express();</span></span>
<span class="line"><span>//  middleware</span></span>
<span class="line"><span>console.log(process.env.NODE_ENV);</span></span>
<span class="line"><span>if (process.env.NODE_ENV === &#39;development&#39;) {</span></span>
<span class="line"><span>  app.use(morgan(&#39;dev&#39;));</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use(express.json());</span></span>
<span class="line"><span>app.use(express.static(`${__dirname}/public`));</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use((req, res, next) =&gt; {</span></span>
<span class="line"><span>  req.requestTime = new Date().toISOString();</span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use(&#39;/api/v1/tours&#39;, tourRouter);</span></span>
<span class="line"><span>app.use(&#39;/api/v1/users&#39;, userRouter);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.all(&#39;*&#39;, (req, res, next) =&gt; {</span></span>
<span class="line"><span>  // res.status(404).json({</span></span>
<span class="line"><span>  //   status: &#39;fail&#39;,</span></span>
<span class="line"><span>  //   message: `Can&#39;t find ${req.originalUrl} on this server`</span></span>
<span class="line"><span>  // });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const err = new Error(`Can&#39;t find ${req.originalUrl} on this server`)</span></span>
<span class="line"><span>  err.status = &#39;fail&#39;</span></span>
<span class="line"><span>  err.statusCode = 404</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  next(err)</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>app.use((err,req,res,next) =&gt; {</span></span>
<span class="line"><span>  res.statusCode = err.statusCode || 500;</span></span>
<span class="line"><span>  err.status = err.status || &#39;error&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  res.status(err.statusCode).json({</span></span>
<span class="line"><span>    status:err.status,</span></span>
<span class="line"><span>    message:err.message</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>})</span></span>
<span class="line"><span>module.exports = app;</span></span></code></pre></div><p>å°è£…</p><p>utils/appError.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>class AppError extends Error {</span></span>
<span class="line"><span>  constructor(message, statusCode) {</span></span>
<span class="line"><span>    super(message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    this.statusCode = statusCode;</span></span>
<span class="line"><span>    this.status = `${statusCode}`.startsWith(&#39;4&#39;) ? &#39;fail&#39; : &#39;error&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    this.isOperational = true;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Error.captureStackTrace(this, this.constructor);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = AppError;</span></span></code></pre></div><p>controllers/errorController</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>module.exports = (err, req, res, next) =&gt; {</span></span>
<span class="line"><span>  res.statusCode = err.statusCode || 500;</span></span>
<span class="line"><span>  err.status = err.status || &#39;error&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  res.status(err.statusCode).json({</span></span>
<span class="line"><span>    status: err.status,</span></span>
<span class="line"><span>    message: err.message,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>é¦–å…ˆï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>catchAsync</code>çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°<code>fn</code>ï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ã€‚å®ƒè¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°<code>req</code>ã€<code>res</code>å’Œ<code>next</code>ï¼Œä»£è¡¨è¯·æ±‚å¯¹è±¡ã€å“åº”å¯¹è±¡å’Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ã€‚</p><p>åœ¨è¿”å›çš„å‡½æ•°å†…éƒ¨ï¼Œå®ƒè°ƒç”¨äº†<code>fn</code>å‡½æ•°å¹¶ä¼ å…¥<code>req</code>ã€<code>res</code>å’Œ<code>next</code>ä½œä¸ºå‚æ•°ã€‚ç„¶åï¼Œä½¿ç”¨<code>.catch()</code>æ–¹æ³•æ¥æ•è·<code>fn</code>å‡½æ•°ä¸­çš„å¼‚æ­¥é”™è¯¯ï¼Œå¹¶å°†é”™è¯¯ä¼ é€’ç»™<code>next</code>å‡½æ•°å¤„ç†ã€‚</p><p>ç„¶åï¼Œé€šè¿‡<code>exports.createTour</code>å°†å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä½œä¸ºä¸­é—´ä»¶å¯¼å‡ºã€‚è¿™ä¸ªä¸­é—´ä»¶å‡½æ•°ä½¿ç”¨<code>catchAsync</code>å‡½æ•°å¯¹å…¶è¿›è¡ŒåŒ…è£…ã€‚åœ¨è¿™ä¸ªä¸­é—´ä»¶å‡½æ•°å†…éƒ¨ï¼Œå®ƒé¦–å…ˆä½¿ç”¨<code>await</code>å…³é”®å­—æ¥ç­‰å¾…<code>Tour.create(req.body)</code>çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„Tourå¯¹è±¡ï¼Œå¹¶å°†<code>req.body</code>ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚ç„¶åï¼Œé€šè¿‡<code>res.status(201).json()</code>æ–¹æ³•å°†æˆåŠŸçš„å“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼Œè¿”å›JSONæ ¼å¼çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº†æ–°åˆ›å»ºçš„Tourå¯¹è±¡ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œè¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª<code>catchAsync</code>å‡½æ•°ï¼Œç”¨äºå¤„ç†å¼‚æ­¥å‡½æ•°çš„é”™è¯¯æ•è·ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸­é—´ä»¶å‡½æ•°åœ¨<code>exports.createTour</code>ä¸­ä½¿ç”¨ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Tourå¯¹è±¡ï¼Œå¹¶å°†ç»“æœä½œä¸ºæˆåŠŸçš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const catchAsync = (fn) =&gt; {</span></span>
<span class="line"><span>  return (req, res, next) =&gt; {</span></span>
<span class="line"><span>    fn(req, res, next).catch(next);</span></span>
<span class="line"><span>  };</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.createTour = catchAsync (async (req, res, next) =&gt; {</span></span>
<span class="line"><span>  const newTour = await Tour.create(req.body);</span></span>
<span class="line"><span>  res.status(201).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      tours: newTour,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>})</span></span></code></pre></div><p>npm i bcryptjs</p><p>npm i jsonwebtoken</p><p><a href="https://jwt.io/" target="_blank" rel="noreferrer">https://jwt.io/</a></p><p>userModel.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const mongoose = require(&#39;mongoose&#39;);</span></span>
<span class="line"><span>const validator = require(&#39;validator&#39;);</span></span>
<span class="line"><span>const bcrypt = require(&#39;bcryptjs&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// name, email,photo,password,passwordConfirm</span></span>
<span class="line"><span>const userSchema = new mongoose.Schema({</span></span>
<span class="line"><span>  name: {</span></span>
<span class="line"><span>    type: String,</span></span>
<span class="line"><span>    required: [true, &#39;A user must have a name&#39;],</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  email: {</span></span>
<span class="line"><span>    type: String,</span></span>
<span class="line"><span>    required: [true, &#39;A user must have a email&#39;],</span></span>
<span class="line"><span>    lowercase: true,</span></span>
<span class="line"><span>    unique: true,</span></span>
<span class="line"><span>    validate: [validator.isEmail, &#39;Please provide a valid email~&#39;],</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  photo: {</span></span>
<span class="line"><span>    type: String,</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  password: {</span></span>
<span class="line"><span>    type: String,</span></span>
<span class="line"><span>    required: [true, &#39;A user must have a password&#39;],</span></span>
<span class="line"><span>    minlength: 8,</span></span>
<span class="line"><span>    select: false,</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  passwordConfirm: {</span></span>
<span class="line"><span>    type: String,</span></span>
<span class="line"><span>    required: [true, &#39;A user must have a name&#39;],</span></span>
<span class="line"><span>    validate: {</span></span>
<span class="line"><span>      // /This only works on CREATE and SAVE!!!</span></span>
<span class="line"><span>      validator: function (el) {</span></span>
<span class="line"><span>        return el === this.password;</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      message: &#39;Passwords are not the same&#39;,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>userSchema.pre(&#39;save&#39;, async function (next) {</span></span>
<span class="line"><span>  // /Only run this function if password was actually modified</span></span>
<span class="line"><span>  if (!this.isModified(&#39;password&#39;)) return next();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  //   /Hash the password with cost of 12</span></span>
<span class="line"><span>  this.password = await bcrypt.hash(this.password, 12);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  //   delete passwordConfirm field</span></span>
<span class="line"><span>  this.passwordConfirm = undefined;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  next();</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>userSchema.methods.correctPassword = async function(candidatePassword,userPassword){</span></span>
<span class="line"><span>    return await bcrypt.compare(candidatePassword,userPassword)</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const User = mongoose.model(&#39;User&#39;, userSchema);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>module.exports = User;</span></span></code></pre></div><p>authController.js</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>const jwt = require(&#39;jsonwebtoken&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const User = require(&#39;./../models/userModel&#39;);</span></span>
<span class="line"><span>const catchAsync = require(&#39;./../utils/catchAsync&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const AppError = require(&#39;./../utils/appError&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>const signToken = id =&gt; {</span></span>
<span class="line"><span>  return jwt.sign({ id }, process.env.JWT_SECRET, {</span></span>
<span class="line"><span>    expiresIn: process.env.JWT_EXPIRES_IN,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.signup = catchAsync(async (req, res, next) =&gt; {</span></span>
<span class="line"><span>  // const newUser = await User.create(req.body);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // basically we only allow the data that we actually need</span></span>
<span class="line"><span>  const newUser = await User.create({</span></span>
<span class="line"><span>    name: req.body.name,</span></span>
<span class="line"><span>    email: req.body.email,</span></span>
<span class="line"><span>    password: req.body.password,</span></span>
<span class="line"><span>    passwordConfirm: req.body.passwordConfirm,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  const token = signToken(newUser._id)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  res.status(201).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    token,</span></span>
<span class="line"><span>    data: {</span></span>
<span class="line"><span>      user: newUser,</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>exports.login = catchAsync(async (req, res, next) =&gt; {</span></span>
<span class="line"><span>  const { email, password } = req.body;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // 1. check if email and password exist</span></span>
<span class="line"><span>  if (!email || !password) {</span></span>
<span class="line"><span>    return next(new AppError(&#39;Please provide email and password&#39;, 400));</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  // 2. check if user exists &amp;&amp; password is correct</span></span>
<span class="line"><span>  const user = await User.findOne({email}).select(&#39;+password&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  if(!user || !(await user.correctPassword(password,user.password))) {</span></span>
<span class="line"><span>    return next(new AppError(&#39;Incorrect email or password&#39;,401))</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  // 3. if everything ok, send token to client</span></span>
<span class="line"><span>  const token = signToken(user._id)</span></span>
<span class="line"><span>  res.status(200).json({</span></span>
<span class="line"><span>    status: &#39;success&#39;,</span></span>
<span class="line"><span>    token,</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span>}) ;</span></span></code></pre></div><p>npm i nodemailer</p><p><a href="https://mailtrap.io/" target="_blank" rel="noreferrer">https://mailtrap.io/</a></p><p><strong>COMPROMISED DATABASE</strong> Strongly encrypt passwords with salt and hash(bcrypt) Strongly encrypt password reset tokens(SHA 256) <strong>BRUTE FORCE ATTACKS</strong> Use bcrypt(to make login requests slow) Implement rate limiting(express-rate-limit) Implement maximum login attempts <strong>CROSS-SITE SCRIPTING(XSS)ATTACKS</strong> Store JWT in HTTPOnly cookies Sanitize user input data Set special HTTP headers (helmet package) <strong>DENIAL-OF-SERVICE(DOS)ATTACK</strong> Implement rate limiting (express-rate-limit) Limit body payload(in body-parser) Avoid evil regular expressions</p><p><strong>NOSQL QUERY INJECTION</strong> Use mongoose for MongoDB(because of SchemaTypes) Sanitize user input data <strong>OTHER BEST PRACTICES AND SUGGESTIONS</strong> Always use HTTPS Create random password reset tokens with expiry dates Deny access to JWT after password change Don&#39;t commit sensitive config data to Git Don&#39;t send error details to clients Prevent Cross-Site Request Forgery(csurf package) Require re-authentication before a high-value action Implement a blacklist of untrusted JWT Confirm user email address after first creating account Keep user logged in with refresh tokens Implement two-factor authentication Prevent parameter pollution causing Uncaught Exceptions</p><p>npm i express-rate-limit</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> limiter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rateLimit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  max:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  windowMs:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  message:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Too many requests from this IP, please try again in an hour~&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// And so that will then affect all of the routes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,limiter)</span></span></code></pre></div><p>npm i helmet</p><p>npm i express-mongo-sanitize</p><p>npm i xss-clean</p><p>npm i hpp</p><hr><p>P147</p><p>The most important principle is:Structure your data to match the ways that your application queries and updates data; In other words:Identify the questions that arise from your application&#39;s use cases first,and then model your data so that the questions can get answered in the most efficient way; In general,always favor embedding,unless there is a good reason not to embed.Especially on 1:FEW and 1:MANY relationships; A 1:TON or a MANY:MANY relationship is usually a good reason to reference instead of embedding; Also,favor referencing when data is updated a lot and if you need to frequently access a dataset on its own; Use embedding when data is mostly read but rarely updated,and when two datasets belong intrinsically together; Don&#39;t allow arrays to grow indefinitely.Therefore,if you need to normalize,use child referencing for 1:MANY relationships,and parent referencing for 1:TON relationships; Use two-way referencing for MANY:MANY relationships.</p><p>node ./dev-data/data/import-dev-data.js --delete</p><p>node ./dev-data/data/import-dev-data.js --import</p><p>npm i pug</p><p><a href="https://account.mapbox.com/auth/signup/" target="_blank" rel="noreferrer">https://account.mapbox.com/auth/signup/</a></p><p>npm i cookie-parser</p></div></div></main><footer class="VPDocFooter" data-v-b0fc1131 data-v-a39e73fe><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-99b11b48 data-v-202d398a><div class="container" data-v-202d398a><p class="message" data-v-202d398a>Thank you once again for reading.</br>Wishing you a wonderful day.ğŸŒ·</p><!----></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about.md\":\"4DzuBwj2\",\"blog_bug_index.md\":\"a8X-lPPn\",\"blog_doing_cs50.md\":\"CaA0yKcO\",\"blog_doing_node.md\":\"D2P-IzBa\",\"blog_interview_index.md\":\"CPvzn7-x\",\"blog_react_index.md\":\"-BrSAIKY\",\"blog_tailwind_index.md\":\"B-d5VxsX\",\"blog_vitepress_index.md\":\"BVlXUlJK\",\"blog_vue2_index.md\":\"BNvML2ff\",\"blog_vue3_index.md\":\"D5COGnFM\",\"english_article_casual.md\":\"CQZ9du2x\",\"english_article_introduce.md\":\"QMqLihHh\",\"english_article_june.md\":\"CD21r-gD\",\"english_article_may.md\":\"bRexg_b0\",\"english_cambly_cambly.md\":\"CXfIzC1_\",\"english_cambly_preparation.md\":\"iEAW3KeN\",\"english_englishpod_part01.md\":\"odZ-vMeA\",\"english_englishpod_tips.md\":\"gKMBP9Pu\",\"english_speaking_inspiration.md\":\"Cncw5VCX\",\"english_writing_inspiration.md\":\"Y1vr4Xng\",\"english_youtube_tiffani.md\":\"0G6krZrC\",\"index.md\":\"Plue4TXC\",\"life_2022_summary.md\":\"CaWvO3WM\",\"life_2023_april.md\":\"CeHHYq2f\",\"life_2023_august.md\":\"DjAl1J_G\",\"life_2023_december.md\":\"2JBuI5R8\",\"life_2023_february.md\":\"Dgg7VWlx\",\"life_2023_january.md\":\"Dvf-XgqH\",\"life_2023_july.md\":\"DOoAhqfE\",\"life_2023_june.md\":\"DQVYVIXJ\",\"life_2023_march.md\":\"CPA3ViyA\",\"life_2023_may.md\":\"B_AUZObb\",\"life_2023_november.md\":\"DDBQSyHB\",\"life_2023_october.md\":\"CmrfCXGT\",\"life_2023_plan.md\":\"kPZaFxBF\",\"life_2023_september.md\":\"DrHSDOff\",\"life_2023_tracker.md\":\"ObVejCdE\",\"life_2024_index.md\":\"CSy3D4fJ\",\"list_book_index.md\":\"C5axEtN7\",\"list_movie_fame.md\":\"B49WRooW\",\"list_movie_index.md\":\"CHPspxBo\",\"list_movie_life.md\":\"BGKfVubS\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Chloe's Blog\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"siteTitle\":\"Hi! It's me!Chloe here~\",\"logo\":\"/logo.png\",\"outlineTitle\":\"outline\",\"outline\":\"deep\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Chloe2099\"},{\"icon\":\"instagram\",\"link\":\"https://instagram.com/chloe20990109/\"},{\"icon\":\"youtube\",\"link\":\"...\"}],\"nav\":[{\"text\":\"ğŸ Home\",\"link\":\"/\"},{\"text\":\"ğŸŒ³Blog\",\"items\":[{\"text\":\"What I Am Doing\",\"link\":\"/blog/doing/node\"}],\"activeMatch\":\"/blog/\"},{\"text\":\"ğŸŒ±Life Insights\",\"items\":[{\"text\":\"2022\",\"link\":\"/life/2022/summary\"},{\"text\":\"2023\",\"link\":\"/life/2023/June\"},{\"text\":\"2024\",\"link\":\"/life/2024/\"}],\"activeMatch\":\"/life/\"},{\"text\":\"ğŸŒµEnglish Corner\",\"items\":[{\"text\":\"Learning in YouTube\",\"link\":\"/english/youtube/Tiffani\"},{\"text\":\"Cambly\",\"link\":\"/english/cambly/cambly\"},{\"text\":\"Record\",\"link\":\"/english/article/may\"}],\"activeMatch\":\"/english/\"},{\"text\":\"ğŸŒ²Movies and Books\",\"items\":[{\"text\":\"Movie and TV show list\",\"link\":\"/list/movie/\"},{\"text\":\"Book List\",\"link\":\"/list/book/\"}],\"activeMatch\":\"/list/\"},{\"text\":\"ğŸŒ·About Me\",\"link\":\"/about\"}],\"sidebar\":{\"/life/\":[{\"text\":\"2022\",\"items\":[{\"text\":\"2022 Annual Summary\",\"link\":\"/life/2022/summary\"}]},{\"text\":\"2023\",\"items\":[{\"text\":\"2023 Annual Plan\",\"link\":\"/life/2023/plan\"},{\"text\":\"January\",\"link\":\"/life/2023/January\"},{\"text\":\"February\",\"link\":\"/life/2023/February\"},{\"text\":\"March\",\"link\":\"/life/2023/March\"},{\"text\":\"April\",\"link\":\"/life/2023/April\"},{\"text\":\"May\",\"link\":\"/life/2023/May\"},{\"text\":\"June\",\"link\":\"/life/2023/June\"},{\"text\":\"July\",\"link\":\"/life/2023/July\"},{\"text\":\"August\",\"link\":\"/life/2023/August\"},{\"text\":\"September\",\"link\":\"/life/2023/September\"},{\"text\":\"October\",\"link\":\"/life/2023/October\"},{\"text\":\"November\",\"link\":\"/life/2023/November\"},{\"text\":\"December\",\"link\":\"/life/2023/December\"}]},{\"text\":\"2024\",\"items\":[{\"text\":\"...not now\",\"link\":\"/life/2024/index\"}]}],\"/english/\":[{\"text\":\"Learning in YouTube\",\"items\":[{\"text\":\"Introduce\",\"link\":\"/english/article/introduce\"},{\"text\":\"Tiffani\",\"link\":\"/english/youtube/Tiffani\"}]},{\"text\":\"Cambly\",\"items\":[{\"text\":\"Course Record\",\"link\":\"/english/cambly/cambly\"},{\"text\":\"Preparation\",\"link\":\"/english/cambly/preparation\"}]},{\"text\":\"Record\",\"items\":[{\"text\":\"May\",\"link\":\"/english/article/May\"}]}],\"/blog/\":[],\"list\":[{\"text\":\"Movie and TV show list\",\"items\":[{\"text\":\"Movie and TV show list\",\"link\":\"/list/movie/\"}]},{\"text\":\"Book List\",\"items\":[{\"text\":\"Book List\",\"link\":\"/list/book/\"}]}]},\"footer\":{\"message\":\"Thank you once again for reading.</br>Wishing you a wonderful day.ğŸŒ·\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>